<!DOCTYPE html>
<html lang={{ lang }} id="updform">
  <head>
    <!-- $Id: updfam.txt v7.1 12/12/2024 05:28:35 $ -->
    <!-- Copyright (c) 1998-2007 INRIA -->
    <meta name="robots" content="none" />
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon_gwd.png') }}" />
    <title>{{ _('Add family') }}</title>
    <!-- gw/etc/css.txt --->
    <!-- $Id: css.txt v7.1 04/11/2023 04:28:54 $ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/all.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/css.css') }}"
    />
    <!-- gw/etc/css.txt --->
    <style>
      /* Small UI tweaks for this template:
         - Add visible background to the top navigation bar
         - keep nav pills visually inert (no hard active background)
         - remove focus outlines that looked like a "flash" when clicking fragment links
         - ensure card headers have a visible background and are not occluded by the fixed nav
      */

      /* Give the top navigation bar a visible background */
      .container.fixed-top {
        background-color: #ffffff !important;
        border-bottom: 1px solid #e9ecef !important;
        padding-top: 4px !important;
        padding-bottom: 4px !important;
      }

      /* Ensure the navbar itself has the same background */
      #banner.navbar {
        background-color: #ffffff !important;
        padding-top: 0.25rem !important;
        padding-bottom: 0.25rem !important;
      }

      /* Top nav pills: avoid strong active background so the look is consistent */
      .nav-pills .nav-link.active,
      .nav-pills .show > .nav-link {
        background-color: transparent !important;
        color: inherit !important;
      }

      /* Remove keyboard/focus outlines that produced an undesirable highlight */
      a:focus, a:active, button:focus, button:active, .nav-link:focus, .nav-link:active, h3:focus, :target {
        outline: none !important;
        box-shadow: none !important;
      }

      /* Make card headers visually distinct and guaranteed visible.
         Use a stronger background than bootstrap's very faint tint so users see it.
      */
      .card .card-header {
        background-color: #f1f3f5 !important; /* slightly darker than bootstrap's .03 tint */
        border-bottom: 1px solid rgba(0,0,0,0.06) !important;
      }

      /* The page uses a fixed-top nav; add top padding so headers are not hidden
         under the nav when jumping to fragments. Adjust if your nav height differs.
      */
      body#family {
        padding-top: 50px; /* reduced for smaller navbar */
      }

      /* Slightly lift headers above surrounding content if overlapping still occurs */
      .card .card-header { position: relative; z-index: 1; }
    </style>
  </head>
  <body id="family">
    <!-- gw/etc/hed.txt --->
    <meta name="format-detection" content="telephone=no" />
    <!-- gw/etc/hed.txt --->
    <div class="container">
      <h1 class="mt-5">{{ _('Add family') }}</h1>
      <form
        method="post"
        action="{{ url_for('gwd.route_ADD_FAM', base=base, lang=lang) }}"
        id="updfam"
        data-insert=""
      >
        <div class="row">
          <div class="container fixed-top" role="navigation">
            <nav
              class="navbar navbar-light justify-content-center mx-2"
              id="banner"
            >
              <nav class="nav nav-pills nav-fill">
                <a class="nav-item nav-link px-2 py-1" href="#parents" title="{{ _('Parents') }}">
                  <i class="fa fa-person fa-fw" aria-hidden="true"></i>
                  <i class="fa fa-person-dress" aria-hidden="true"></i>
                  <span class="d-none d-md-inline-flex ml-1">{{ _('Parents') }}</span>
                </a>

                <a class="nav-item nav-link px-2 py-1" href="#events" title="{{ _('Events') }}">
                  <i class="fa fa-graduation-cap fa-fw" aria-hidden="true"></i>
                  <span class="d-none d-md-inline-flex ml-1">{{ _('Events') }}</span>
                </a>

                <a class="nav-item nav-link px-2 py-1" href="#children" title="{{ _('Children') }}">
                  <i class="fa fa-child fa-fw" aria-hidden="true"></i>
                  <span class="d-none d-md-inline-flex ml-1">{{ _('Children') }}</span>
                </a>

                <a class="nav-item nav-link px-2 py-1" href="#sources" title="{{ _('Sources') }}">
                  <i class="fa fa-star fa-fw" aria-hidden="true"></i>
                  <span class="d-none d-lg-inline-flex ml-1">{{ _('Sources') }}</span>
                </a>

                <a class="nav-item nav-link px-2 py-1" href="#comments" title="{{ _('Comment') }}">
                  <i class="fa fa-file-lines fa-fw" aria-hidden="true"></i>
                  <span class="d-none d-lg-inline-flex ml-1">{{ _('Comment') }}</span>
                </a>
              </nav>
            </nav>
          </div>
        </div>
        <p class="my-0">
          <input type="hidden" name="digest" value="" />
          <input type="hidden" name="m" value="ADD_FAM_OK" />
        </p>
        <div class="card">
          <h3
            class="card-header py-1 text-center"
            id="parents"
            aria-label="§ {{ _('Parents') }}"
          >
            {{ _('Parents') }}
          </h3>
          <div class="card-body">
            <div class="row">
              <div class="col-12">
                <div class="row">
                  <label for="pa1_fn" class="col-sm-2 col-form-label"
                    >{{ _('First name') }}
                    <span class="font-weight-bold text-uppercase">
                      ({{ _('M') }})</span
                    ></label
                  >
                  <div class="col-sm-8">
                    <input
                      class="form-control"
                      type="text"
                      name="pa1_fn"
                      value=""
                      id="pa1_fn"
                      placeholder="{{ _('First name') }}"
                      list="datalist_fnames"
                      data-book="fn"
                      autofocus
                    />
                  </div>
                  <label for="pa1_occ" class="col-auto col-form-label sr-only"
                    >{{ _('Number') }}</label
                  >
                  <div class="col-sm-2">
                    <input
                      class="form-control"
                      type="number"
                      name="pa1_occ"
                      min="0"
                      value="0"
                      id="pa1_occ"
                      title="{{ _('Number (occurrence)') }}"
                    />
                  </div>
                </div>
                <div class="row mt-2">
                  <label for="pa1_sn" class="col-sm-2 col-form-label"
                    >{{ _('Surname') }}</label
                  >
                  <div class="col-sm-8">
                    <input
                      class="form-control"
                      type="text"
                      name="pa1_sn"
                      value=""
                      id="pa1_sn"
                      placeholder="{{ _('Surname') }}"
                      list="datalist_snames"
                      data-book="sn"
                    />
                  </div>
                  <div class="col-sm-2">
                    <select class="form-control" id="pa1_p_selct" name="pa1_p">
                      <option value="create" selected>{{ _('Create') }}</option>
                      <option value="link">{{ _('Link') }}</option>
                    </select>
                  </div>
                  <div id="pa1_p_selct_mod" class="col-form-label ml-2" style="display:none;">
                    <a href="#" onclick="alert('MOD_IND route not yet implemented'); return false;">
                      <i class="fa fa-user-pen fa-fw ml-2 mr-1"></i>
                      {{ _('Modify person') }}
                    </a>
                  </div>
                </div>
                <div id="pa1_p_selct_data">
                  <div class="row align-items-center">
                    <span class="col-sm-2 col-form-label">{{ _('Birth') }}</span>
                    <div class="col-sm-auto d-inline-flex">
                      <label for="pa1b_dd" class="col-form-label sr-only"
                        >{{ _('day') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa1b_dd"
                        id="pa1b_dd"
                        value=""
                        placeholder="{{ _('dd') }}"
                        pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                        size="2"
                        maxlength="2"
                      />
                      <label for="pa1b_mm" class="col-form-label sr-only"
                        >{{ _('month') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa1b_mm"
                        id="pa1b_mm"
                        value=""
                        placeholder="{{ _('mm') }}"
                        pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                        size="1"
                        maxlength="2"
                      />
                      <label for="pa1b_yyyy" class="col-form-label sr-only"
                        >{{ _('year') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa1b_yyyy"
                        id="pa1b_yyyy"
                        value=""
                        placeholder="{{ _('yyyy') }}"
                        pattern="[?><~/+\-]?\d*/?"
                        size="4"
                        maxlength="8"
                      />
                    </div>
                    <label for="pa1b_pl" class="sr-only col-sm-1 col-form-label"
                      >{{ _('place') }}</label
                    >
                    <div class="col">
                      <input
                        type="text"
                        class="form-control"
                        name="pa1b_pl"
                        value=""
                        id="pa1b_pl"
                        placeholder="{{ _('Place') }}"
                        list="datalist_places"
                        data-book="{{ _('place') }}"
                      />
                    </div>
                  </div>
                  <div class="row align-items-center">
                    <span class="col-sm-2 col-form-label">{{ _('Death') }}</span>
                    <div class="col-sm-auto d-inline-flex">
                      <label for="pa1d_dd" class="col-form-label sr-only"
                        >{{ _('day') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa1d_dd"
                        id="pa1d_dd"
                        value=""
                        placeholder="{{ _('dd') }}"
                        pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                        size="2"
                        maxlength="2"
                      />
                      <label for="pa1d_mm" class="col-form-label sr-only"
                        >{{ _('month') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa1d_mm"
                        id="pa1d_mm"
                        value=""
                        placeholder="{{ _('mm') }}"
                        pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                        size="1"
                        maxlength="2"
                      />
                      <label for="pa1d_yyyy" class="col-form-label sr-only"
                        >{{ _('year') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa1d_yyyy"
                        id="pa1d_yyyy"
                        value=""
                        placeholder="{{ _('yyyy') }}"
                        pattern="[?><~/+\-]?\d*/?"
                        size="4"
                        maxlength="8"
                      />
                    </div>
                    <label for="pa1d_pl" class="sr-only col-sm-1 col-form-label"
                      >{{ _('place') }}</label
                    >
                    <div class="col">
                      <input
                        type="text"
                        class="form-control"
                        name="pa1d_pl"
                        value=""
                        id="pa1d_pl"
                        placeholder="{{ _('Place') }}"
                        list="datalist_places"
                        data-book="{{ _('place') }}"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <label for="pa1_occu" class="col-sm-2 col-form-label"
                      >{{ _('Occupation') }}</label
                    >
                    <div class="col-sm">
                      <input
                        class="form-control"
                        name="pa1_occu"
                        id="pa1_occu"
                        placeholder="{{ _('Occupation') }}"
                        value=""
                        list="datalist_occupations"
                        data-book="occu"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="row mt-3">
                  <label for="pa2_fn" class="col-sm-2 col-form-label"
                    >{{ _('First name') }}
                    <span class="font-weight-bold text-uppercase">
                      (F)</span
                    ></label
                  >
                  <div class="col-sm-8">
                    <input
                      class="form-control"
                      type="text"
                      name="pa2_fn"
                      value=""
                      id="pa2_fn"
                      placeholder="{{ _('First name') }}"
                      list="datalist_fnames"
                      data-book="fn"
                      autofocus
                    />
                  </div>
                  <label for="pa2_occ" class="col-auto col-form-label sr-only"
                    >{{ _('Number') }}</label
                  >
                  <div class="col-sm-2">
                    <input
                      class="form-control"
                      type="number"
                      name="pa2_occ"
                      min="0"
                      value="0"
                      id="pa2_occ"
                      title="Numéro (occurence)"
                    />
                  </div>
                </div>
                <div class="row mt-2">
                  <label for="pa2_sn" class="col-sm-2 col-form-label"
                    >{{ _('Surname') }}</label
                  >
                  <div class="col-sm-8">
                    <input
                      class="form-control"
                      type="text"
                      name="pa2_sn"
                      value=""
                      id="pa2_sn"
                      placeholder="{{ _('Surname') }}"
                      list="datalist_snames"
                      data-book="sn"
                    />
                  </div>
                  <div class="col-sm-2">
                    <select class="form-control" id="pa2_p_selct" name="pa2_p">
                      <option value="create" selected>{{ _('Create') }}</option>
                      <option value="link">{{ _('Link') }}</option>
                    </select>
                  </div>
                  <div id="pa2_p_selct_mod" class="col-form-label ml-2" style="display:none;">
                    <a href="#" onclick="alert('MOD_IND route not yet implemented'); return false;">
                      <i class="fa fa-user-pen fa-fw ml-2 mr-1"></i>
                      {{ _('Modify person') }}
                    </a>
                  </div>
                </div>
                <div id="pa2_p_selct_data">
                  <div class="row align-items-center">
                    <span class="col-sm-2 col-form-label">{{ _('Birth') }}</span>
                    <div class="col-sm-auto d-inline-flex">
                      <label for="pa2b_dd" class="col-form-label sr-only"
                        >{{ _('day') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa2b_dd"
                        id="pa2b_dd"
                        value=""
                        placeholder="{{ _('dd') }}"
                        pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                        size="2"
                        maxlength="2"
                      />
                      <label for="pa2b_mm" class="col-form-label sr-only"
                        >{{ _('month') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa2b_mm"
                        id="pa2b_mm"
                        value=""
                        placeholder="{{ _('mm') }}"
                        pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                        size="1"
                        maxlength="2"
                      />
                      <label for="pa2b_yyyy" class="col-form-label sr-only"
                        >{{ _('year') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa2b_yyyy"
                        id="pa2b_yyyy"
                        value=""
                        placeholder="{{ _('yyyy') }}"
                        pattern="[?><~/+\-]?\d*/?"
                        size="4"
                        maxlength="8"
                      />
                    </div>
                    <label for="pa2b_pl" class="sr-only col-sm-1 col-form-label"
                      >{{ _('place') }}</label
                    >
                    <div class="col">
                      <input
                        type="text"
                        class="form-control"
                        name="pa2b_pl"
                        value=""
                        id="pa2b_pl"
                        placeholder="{{ _('Place') }}"
                        list="datalist_places"
                        data-book="{{ _('place') }}"
                      />
                    </div>
                  </div>
                  <div class="row align-items-center">
                    <span class="col-sm-2 col-form-label">{{ _('Death') }}</span>
                    <div class="col-sm-auto d-inline-flex">
                      <label for="pa2d_dd" class="col-form-label sr-only"
                        >{{ _('day') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa2d_dd"
                        id="pa2d_dd"
                        value=""
                        placeholder="{{ _('dd') }}"
                        pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                        size="2"
                        maxlength="2"
                      />
                      <label for="pa2d_mm" class="col-form-label sr-only"
                        >{{ _('month') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa2d_mm"
                        id="pa2d_mm"
                        value=""
                        placeholder="{{ _('mm') }}"
                        pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                        size="1"
                        maxlength="2"
                      />
                      <label for="pa2d_yyyy" class="col-form-label sr-only"
                        >{{ _('year') }}</label
                      >
                      <input
                        type="text"
                        class="form-control mr-2"
                        name="pa2d_yyyy"
                        id="pa2d_yyyy"
                        value=""
                        placeholder="{{ _('yyyy') }}"
                        pattern="[?><~/+\-]?\d*/?"
                        size="4"
                        maxlength="8"
                      />
                    </div>
                    <label for="pa2d_pl" class="sr-only col-sm-1 col-form-label"
                      >{{ _('place') }}</label
                    >
                    <div class="col">
                      <input
                        type="text"
                        class="form-control"
                        name="pa2d_pl"
                        value=""
                        id="pa2d_pl"
                        placeholder="{{ _('Place') }}"
                        list="datalist_places"
                        data-book="{{ _('place') }}"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <label for="pa2_occu" class="col-sm-2 col-form-label"
                      >{{ _('Occupation') }}</label
                    >
                    <div class="col-sm">
                      <input
                        class="form-control"
                        name="pa2_occu"
                        id="pa2_occu"
                        placeholder="{{ _('Occupation') }}"
                        value=""
                        list="datalist_occupations"
                        data-book="occu"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="custom-control custom-checkbox mt-3 ml-3">
                <input
                  type="checkbox"
                  class="custom-control-input"
                  name="nsck"
                  id="nsck"
                  value="on"
                />
                <label for="nsck" class="custom-control-label"
                  >{{ _('Same-sex relationship (no sex validation)') }}</label
                >
              </div>
              <button
                type="submit"
                class="btn btn-outline-primary col-3 ml-auto mt-3 mr-3"
                title="{{ _('Validate') }}"
                aria-label="{{ _('Validate') }}"
              >
                <span class="font-weight-bold text-uppercase sr-only"
                  >{{ _('Validate') }}</span
                >
                OK
                <i
                  class="fa fa-share fa-rotate-180 fa-fw ml-1"
                  aria-hidden="true"
                ></i>
              </button>
            </div>
          </div>
        </div>
        <div class="card">
          <h3
            class="card-header py-1 text-center"
            id="events"
            aria-label="§ {{ _('Events') }}"
          >
            {{ _('Events') }}
          </h3>
          <div class="card-body">
            <div class="row">
              <h5 class="col-form-label col-sm-2 mb-1 text-uppercase">
                <label for="e_name1" class="mb-0">{{ _('Event 1') }}</label>
              </h5>
              <div class="col-sm-3">
                <select
                  class="form-control custom-select font-weight-bold"
                  id="fevent_select1"
                  onchange="show_fevent_label($('#e_name1').prop('defaultValue'), '1')"
                >
                  <option value="" selected disabled>
                    {{ _('Choose an event') }}
                  </option>
                  <option disabled>───────────────</option>
                  <option value="#marr">{{ _('Marriage') }}</option>
                  <option value="#nmar">{{ _('Not married') }}</option>
                  <option value="#enga">{{ _('Engaged') }}</option>
                  <option value="#nmen">{{ _('No mention') }}</option>
                  <option value="#marb">{{ _('Marriage banns') }}</option>
                  <option value="#marc">{{ _('Marriage contract') }}</option>
                  <option value="#marl">{{ _('Marriage license') }}</option>
                  <option value="#pacs">{{ _('Civil union') }}</option>
                  <option value="#div">{{ _('Divorce') }}</option>
                  <option value="#sep">{{ _('Separation') }}</option>
                  <option value="#anul">{{ _('Annulment') }}</option>
                  <option value="#resi">{{ _('Residence') }}</option>
                  <option disabled>───────────────</option>
                  <option value="" id="custom1">{{ _('Custom event') }}</option>
                  <option disabled>───────────────</option>
                  <option value="" id="delete1">{{ _('Delete event') }}</option>
                </select>
              </div>
              <div class="col-sm-7">
                <label
                  id="fevent_label_selector1"
                  style="display: none"
                  class="other_evts w-100"
                >
                  <input
                    type="text"
                    class="form-control font-weight-bold"
                    name="e_name1"
                    value="#marr"
                    id="e_name1"
                    placeholder="{{ _('Event') }}"
                  />
                </label>
              </div>
            </div>
            <div class="row mb-2">
              <label for="e_place1" class="col-sm-2 col-form-label">{{ _('Place') }}</label>
              <div class="col-sm-10">
                <input
                  class="form-control"
                  type="text"
                  name="e_place1"
                  value=""
                  id="e_place1"
                  placeholder="{{ _('Place') }}"
                  list="datalist_places"
                  data-book="{{ _('place') }}"
                />
              </div>
            </div>
            <div class="row mt-1">
              <div class="col-sm-1 col-md-2 col-form-label">{{ _('Date') }}</div>
              <div class="col col-sm-auto form-inline">
                <label>
                  <input
                    type="text"
                    class="form-control"
                    name="e_date1_dd"
                    value=""
                    pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                    size="2"
                    maxlength="2"
                    placeholder=" "
                    placeholder="{{ _('day') }}"
                  />
                  <span class="ml-sm-1 ml-md-2">{{ _('day') }}</span>
                </label>
                <label>
                  <span id="e_date1_mm_sel">
                    <input
                      type="text"
                      class="form-control ml-sm-2 ml-md-3"
                      name="e_date1_mm"
                      value=""
                      pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                      size="1"
                      maxlength="2"
                      placeholder=" "
                    />
                  </span>
                  <span class="ml-sm-1 ml-md-2">{{ _('month') }}</span>
                </label>
                <label>
                  <input
                    type="text"
                    class="form-control ml-sm-2 ml-md-3"
                    name="e_date1_yyyy"
                    value=""
                    pattern="[?><~/+\-]?\d*/?"
                    size="4"
                    maxlength="8"
                    placeholder=" "
                  />
                  <span class="ml-sm-1 ml-md-2">{{ _('year') }}</span>
                </label>
              </div>
              <div class="col-10 col-lg ml-auto form-inline">
                <label for="e_date1_prec" class="sr-only col-form-label"
                  >{{ _('precision') }}</label
                >
                <select
                  class="form-control pl-lg-1 pr-lg-0 px-xl-2"
                  name="e_date1_prec"
                  id="e_date1_prec"
                >
                  <option value="sure">exact</option>
                  <option value="about">vers</option>
                  <option value="maybe">peut-être</option>
                  <option value="before">avant</option>
                  <option value="after">après</option>
                  <option value="oryear">…ou…</option>
                  <option value="yearint">…entre…</option>
                </select>
                <label for="e_date1_cal" class="sr-only col-form-label"
                  >{{ _('calendar') }}</label
                >
                <select
                  class="form-control pl-lg-1 pr-lg-0 px-xl-2 ml-sm-1 ml-md-3"
                  name="e_date1_cal"
                  id="e_date1_cal"
                  onchange="changeCalendar('e_date1_mm_sel','e_date1_mm','',this),changeCalendar('e_date1_ormonth_sel','e_date1_ormonth','',this)"
                >
                  <option value="" selected>-</option>
                  <option value="G">Grégorien</option>
                  <option value="J">Julien</option>
                  <option value="F">{{ _('French Republican') }}</option>
                  <option value="M">{{ _('Hebrew') }}</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-1 col-md-2"></div>
              <div class="col col-sm-auto form-inline">
                <label>
                  <input
                    type="text"
                    class="form-control"
                    name="e_date1_orday"
                    value=""
                    pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                    size="2"
                    maxlength="2"
                    placeholder=" "
                  />
                  <span class="ml-sm-1 ml-md-2">{{ _('day') }}</span>
                </label>
                <label>
                  <span id="e_date1_ormonth_sel">
                    <input
                      type="text"
                      class="form-control ml-sm-1 ml-md-3"
                      name="e_date1_ormonth"
                      value=""
                      pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                      size="1"
                      maxlength="2"
                      placeholder=" "
                    />
                  </span>
                  <span class="ml-sm-1 ml-md-2">{{ _('month') }}</span>
                </label>
                <label>
                  <input
                    type="text"
                    class="form-control ml-sm-1 ml-md-3"
                    name="e_date1_oryear"
                    value=""
                    pattern="[?><~/+\-]?\d*/?"
                    size="4"
                    maxlength="8"
                    placeholder=" "
                  />
                  <span class="ml-sm-1 ml-md-2">{{ _('year') }}</span>
                </label>
              </div>
              <div class="col-10 col-lg">
                <label
                  for="e_date1_text"
                  class="col-form-label sr-only"
                ></label>
                <input
                  type="text"
                  class="form-control"
                  name="e_date1_text"
                  maxlength="100"
                  value=""
                  id="e_date1_text"
                  placeholder="{{ _('…or text') }}"
                />
              </div>
            </div>
            <div class="row mt-2">
              <label for="e_note1" class="col-sm-2 col-form-label">{{ _('Notes') }}</label>
              <div class="col-sm-10 d-inline-flex align-items-start">
                <textarea
                  class="form-control"
                  name="e_note1"
                  rows="1"
                  id="e_note1"
                  placeholder="{{ _('Notes') }}"
                ></textarea>
              </div>
            </div>
            <div class="row mt-0">
              <label for="e_src1" class="col-sm-2 col-form-label">{{ _('Source') }}</label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control"
                  name="e_src1"
                  maxlength="1000"
                  id="e_src1"
                  placeholder="{{ _('Source') }}"
                  value=""
                  list="datalist_sources"
                  data-book="src"
                />
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="row mt-3 mb-1">
                  <label for="e1_ins_witn0_n" class="col-form-label col-2"
                    >{{ _('Insert') }}</label
                  >
                  <div class="form-inline col-10 ml-auto">
                    <div class="input-group">
                      <select
                        class="form-control bg-light border-primary border-right-0"
                        id="e1_ins_witn0_n"
                        name="e1_ins_witn0_n"
                      >
                        <option>1</option>
                         
                        <option>2</option>
                         
                        <option>3</option>
                         
                        <option>4</option>
                         
                        <option>5</option>
                         
                        <option>6</option>
                         
                        <option>7</option>
                         
                        <option>8</option>
                         
                        <option>9</option>
                         
                        <option>10</option>
                         
                      </select>
                      <div class="input-group-append">
                        <label class="btn btn-outline-primary border-left-0">
                          {{ _('witness(es)') }}
                          <input
                            class="ml-1"
                            type="checkbox"
                            name="e1_ins_witn0"
                            value="on"
                          />
                        </label>
                        <button
                          type="submit"
                          class="btn btn-outline-primary"
                          title="Insérer témoin/témoins"
                        >
                          OK
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr class="w-100" />
            <div class="row mt-2">
              <label for="ins_event1_n" class="col-form-label col-2"
                >{{ _('Insert') }}</label
              >
              <div class="form-inline col-10 ml-auto">
                <div class="input-group">
                  <select
                    class="form-control bg-light border-primary border-right-0"
                    id="ins_event1_n"
                    name="ins_event1_n"
                  >
                    <option>1</option>
                     
                    <option>2</option>
                     
                    <option>3</option>
                     
                    <option>4</option>
                     
                    <option>5</option>
                     
                    <option>6</option>
                     
                    <option>7</option>
                     
                    <option>8</option>
                     
                    <option>9</option>
                     
                    <option>10</option>
                     
                  </select>
                  <div class="input-group-append">
                    <label class="btn btn-outline-primary border-left-0">
                      {{ _('event(s)') }}
                      <input
                        class="ml-1"
                        type="checkbox"
                        name="ins_event1"
                        value="on"
                      />
                    </label>
                    <button
                      type="submit"
                      class="btn btn-outline-primary"
                      title="Insérer événement/événements"
                    >
                      OK
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <h3
            class="card-header py-1 text-center"
            id="children"
            aria-label="§ {{ _('Children') }}"
          >
            {{ _('Children') }}
          </h3>
          <div class="card-body">
            <!-- child insert controls removed temporarily (ins_ch0) -->
            <div class="row">
              <hr class="w-100" />
              <h5 class="col-form-label col-sm-2 text-uppercase">{{ _('1st Child') }}</h5>
              <div class="col-sm-2">
                <select class="form-control" name="ch1_p" id="ch1_p_selct">
                  <option value="link">{{ _('Link') }}</option>
                  <option value="create" selected>{{ _('Create') }}</option>
                </select>
              </div>
            </div>
            <div class="row">
              <label for="ch1_fn" class="col-sm-2 col-form-label">{{ _('First name') }}</label>
              <div class="col-sm-6">
                <input
                  class="form-control"
                  type="text"
                  name="ch1_fn"
                  value=""
                  id="ch1_fn"
                  placeholder="{{ _('First name') }}"
                  list="datalist_fnames"
                  data-book="fn"
                />
              </div>
              <label for="ch1_occ" class="col-sm-auto col-form-label"
                >{{ _('Number') }}</label
              >
              <div class="col-sm-2">
                <input
                  class="form-control"
                  type="number"
                  name="ch1_occ"
                  min="0"
                  value="0"
                  id="ch1_occ"
                />
              </div>
            </div>
            <div class="row">
              <label for="ch1_sn" class="col-sm-2 col-form-label"
                >{{ _('Surname') }}</label
              >
              <div class="col-sm-6">
                <input
                  class="form-control"
                  type="text"
                  name="ch1_sn"
                  value=""
                  id="ch1_sn"
                  placeholder=""
                  list="datalist_snames"
                  data-book="sn"
                />
              </div>
              <div id="ch1_p_selct_mod" class="col-form-label ml-2">
                <!-- TODO: Implement MOD_IND route in Flask -->
                <a
                  href="#"
                  title="Modifier personne
.0 "
                  aria-hidden="true"
                  aria-label="{{ _('M') }}"
                  onclick="alert('MOD_IND route not yet implemented'); return false;"
                >
                  <i class="fa fa-user-pen fa-fw male ml-2 mr-1"></i>
                  {{ _('Edit 1st child') }}</a
                >
              </div>
              <div id="ch1_p_selct_sex">
                <div class="d-inline-flex">
                  <span class="col-sm-auto col-form-label">{{ _('Sex') }}</span>
                  <div class="col-sm-auto mt-2">
                    <div class="form-check form-check-inline">
                      <label class="form-check-label">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="ch1_sex"
                          value="M"
                        />{{ _('M') }}
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="ch1_sex"
                          value="N"
                          checked
                        />{{ _('?') }}
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="ch1_sex"
                          value="F"
                        />{{ _('F') }}
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="ch1_p_selct_data">
              <div class="row align-items-center">
                <span class="col-sm-2 col-form-label">{{ _('Birth') }}</span>
                <div class="col-sm-auto d-inline-flex">
                  <label for="ch1b_dd" class="col-form-label sr-only"
                    >{{ _('day') }}</label
                  >
                  <input
                    type="text"
                    class="form-control mr-2"
                    name="ch1b_dd"
                    id="ch1b_dd"
                    value=""
                    placeholder="{{ _('dd') }}"
                    pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                    size="2"
                    maxlength="2"
                  />
                  <label for="ch1b_mm" class="col-form-label sr-only"
                    >{{ _('month') }}</label
                  >
                  <input
                    type="text"
                    class="form-control mr-2"
                    name="ch1b_mm"
                    id="ch1b_mm"
                    value=""
                    placeholder="{{ _('mm') }}"
                    pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                    size="1"
                    maxlength="2"
                  />
                  <label for="ch1b_yyyy" class="col-form-label sr-only"
                    >{{ _('year') }}</label
                  >
                  <input
                    type="text"
                    class="form-control mr-2"
                    name="ch1b_yyyy"
                    id="ch1b_yyyy"
                    value=""
                    placeholder="{{ _('yyyy') }}"
                    pattern="[?><~/+\-]?\d*/?"
                    size="4"
                    maxlength="8"
                  />
                </div>
                <label for="ch1b_pl" class="sr-only col-sm-1 col-form-label"
                  >{{ _('place') }}</label
                >
                <div class="col">
                  <input
                    type="text"
                    class="form-control"
                    name="ch1b_pl"
                    value=""
                    id="ch1b_pl"
                    placeholder="{{ _('Place') }}"
                    list="datalist_places"
                    data-book="{{ _('place') }}"
                  />
                </div>
              </div>
              <div class="row align-items-center">
                <span class="col-sm-2 col-form-label">{{ _('Death') }}</span>
                <div class="col-sm-auto d-inline-flex">
                  <label for="ch1d_dd" class="col-form-label sr-only"
                    >{{ _('day') }}</label
                  >
                  <input
                    type="text"
                    class="form-control mr-2"
                    name="ch1d_dd"
                    id="ch1d_dd"
                    value=""
                    placeholder="{{ _('dd') }}"
                    pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])"
                    size="2"
                    maxlength="2"
                  />
                  <label for="ch1d_mm" class="col-form-label sr-only"
                    >{{ _('month') }}</label
                  >
                  <input
                    type="text"
                    class="form-control mr-2"
                    name="ch1d_mm"
                    id="ch1d_mm"
                    value=""
                    placeholder="{{ _('mm') }}"
                    pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)"
                    size="1"
                    maxlength="2"
                  />
                  <label for="ch1d_yyyy" class="col-form-label sr-only"
                    >{{ _('year') }}</label
                  >
                  <input
                    type="text"
                    class="form-control mr-2"
                    name="ch1d_yyyy"
                    id="ch1d_yyyy"
                    value=""
                    placeholder="{{ _('yyyy') }}"
                    pattern="[?><~/+\-]?\d*/?"
                    size="4"
                    maxlength="8"
                  />
                </div>
                <label for="ch1d_pl" class="sr-only col-sm-1 col-form-label"
                  >{{ _('place') }}</label
                >
                <div class="col">
                  <input
                    type="text"
                    class="form-control"
                    name="ch1d_pl"
                    value=""
                    id="ch1d_pl"
                    placeholder="{{ _('Place') }}"
                    list="datalist_places"
                    data-book="{{ _('place') }}"
                  />
                </div>
              </div>
              <div class="row">
                <label for="ch1_occu" class="col-sm-2 col-form-label"
                  >{{ _('Occupation') }}</label
                >
                <div class="col-sm">
                  <input
                    class="form-control"
                    type="text"
                    name="ch1_occu"
                    value=""
                    id="ch1_occu"
                    placeholder="{{ _('Occupation') }}"
                    list="datalist_occupations"
                    data-book="occu"
                  />
                </div>
              </div>
            </div>
            <!-- child insert controls inside child forms removed temporarily -->
          </div>
        </div>
        <div class="card">
          <h3
            class="card-header py-1 text-center"
            id="sources"
            aria-label="§ Sources"
          >
            {{ _('Sources') }}
          </h3>
          <div class="card-body">
            <div class="row">
              <label for="psrc" class="col-sm-2 col-form-label"
                >{{ _('Persons') }}</label
              >
              <div class="col-sm-10">
                <textarea
                  class="form-control"
                  rows="1"
                  name="psrc"
                  id="psrc"
                  placeholder="{{ _('People sources') }}"
                  datalist_sources;
                ></textarea>
              </div>
            </div>
            <div class="row">
              <label for="src" class="col-sm-2 col-form-label">{{ _('Family') }}</label>
              <div class="col-sm-9">
                <input
                  class="form-control"
                  name="src"
                  id="src"
                  placeholder="Sources famille"
                  value=""
                  datalist_sources;
                />
              </div>
              <div class="col-sm-1">
                <label class="form-check-label">
                  <input type="checkbox" name="rdsrc" value="on" />
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <h3
            class="card-header py-1 text-center"
            id="comments"
            aria-label="§ Commentaire"
          >
            {{ _('Comment') }}
          </h3>
          <div class="d-inline-flex flex-column">
            <div class="col py-1">
              <!-- gw/etc/toolbar.txt --->
              <!-- $Id: toolbar.txt v7.1 09/03/2025 03:17:13 $ -->
              <style>
                .navbar.fixed-top {
                  background-color: rgba(
                    255,
                    255,
                    255,
                    0.95
                  ) !important; /* Slightly transparent background */
                  backdrop-filter: blur(
                    5px
                  ); /* Blur effect for content underneath */
                  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
                }
                /* Navigation elements */
                .nav-link {
                  padding: 0.5rem 0.75rem;
                  color: #495057;
                }
                .nav-link:hover {
                  color: #0056b3;
                }
                /* Dropdown menus */
                .dropdown-menu {
                  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
                  min-width: 220px;
                }
                .format-item {
                  padding: 0.5rem 1rem;
                  display: flex;
                  align-items: center;
                  gap: 0.5rem;
                }
                .format-item i {
                  width: 1rem;
                  text-align: center;
                }
                /* Editor layout */
                .editor-layout {
                  display: grid;
                  grid-template-columns: 1fr 280px;
                  gap: 1.5rem;
                  height: calc(100vh - 120px);
                  margin-top: 1rem;
                }
                .editor-main {
                  height: 100%;
                }
                #notes_comments {
                  height: calc(100% - 50px);
                  font-family: monospace;
                  font-size: 14px;
                  line-height: 1.5;
                }
                .transform-navbar {
                  transform: translateX(
                    -24%
                  ); /* Adjust this value to align with textarea */
                }
                .navbar::before {
                  content: "";
                  position: absolute;
                  bottom: -1px;
                  height: 1px;
                  background: #dee2e6; /* Bootstrap's default border color */
                  z-index: 1;
                }
                .navbar {
                  border-bottom: none !important;
                }
                .w-95 {
                  width: 95%;
                  margin: 0 auto;
                }
                #nav-note {
                  z-index: 1030;
                }
              </style>
              <nav
                id="nav-note"
                class="navbar navbar-expand-lg navbar-light bg-light p-0 w-95"
              >
                <div class="container-fluid">
                  <div class="navbar-nav mx-auto flex-row transform-navbar">
                    <div class="navbar-nav">
                      <!-- HTML Group -->
                      <div class="nav-item dropdown">
                        <a
                          class="nav-link dropdown-toggle"
                          href="test%3Fm=ADD_FAM.html#"
                          id="htmlDropdown"
                          role="button"
                          data-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          &lt;HTML&gt;
                        </a>
                        <div
                          class="dropdown-menu"
                          aria-labelledby="htmlDropdown"
                        >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('<br>\n','','')"
                            title="= shift + enter"
                            >&lt;br/&gt;</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('\n<hr>\n','','')"
                            >&lt;hr/&gt; (————————)</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('','<table border>\n<tr>\n<th>A1</th>\n<th>B1</th>\n</tr><tr>\n<td>A2</td>\n<td>B2</td>\n</tr><tr>\n<td>A3</td>\n<td>B3</td>\n</tr>\n</table>','')"
                            >&lt;table&gt;</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('&lt;img src=&quot;%sm=IM;s=xxx.jpg&quot;/&gt; alt=&quot;?&quot;','','')"
                            ><small
                              >&lt;img alt="?"
                              src="%sm=IM;s=xxx.jpg"/&gt;</small
                            ></a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('&lt;a href=&quot;%sm=IMH;s=xxx.jpg&quot;&gt;Image&lt;/a&gt;','','')"
                            >&lt;a
                            href="%sm=IMH;s=xxx.jpg"&gt;image&lt;/a&gt;</a
                          >
                        </div>
                      </div>
                      <!-- Headings Group -->
                      <div class="nav-item dropdown">
                        <a
                          class="nav-link dropdown-toggle"
                          href="test%3Fm=ADD_FAM.html#"
                          id="headingsDropdown"
                          role="button"
                          data-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          {{ _('h1') }}
                        </a>
                        <div
                          class="dropdown-menu"
                          aria-labelledby="headingsDropdown"
                        >
                          <a
                            class="dropdown-item h1"
                            onclick="return insertTags('=','=','x')"
                            >=h1=</a
                          >
                          <a
                            class="dropdown-item h2"
                            onclick="return insertTags('==','==','x')"
                            >==h2==</a
                          >
                          <a
                            class="dropdown-item h3"
                            onclick="return insertTags('===','===','x')"
                            >===h3===</a
                          >
                          <a
                            class="dropdown-item h4"
                            onclick="return insertTags('====','====','x')"
                            >====h4====</a
                          >
                          <a
                            class="dropdown-item h5"
                            onclick="return insertTags('=====','=====','x')"
                            >=====h5=====</a
                          >
                          <a
                            class="dropdown-item h6"
                            onclick="return insertTags('======','======','x')"
                            >======h6======</a
                          >
                        </div>
                      </div>
                      <!-- Formatting Group -->
                      <div class="nav-item dropdown">
                        <a
                          class="nav-link dropdown-toggle"
                          href="test%3Fm=ADD_FAM.html#"
                          id="formatDropdown"
                          role="button"
                          data-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          {{ _('Format') }}
                        </a>
                        <div
                          class="dropdown-menu"
                          aria-labelledby="formatDropdown"
                        >
                          <a
                            class="dropdown-item format-item"
                            onclick="return insertTags('\'\'','\'\'','x')"
                          >
                            <i class="fas fa-italic"></i> <i>Italic</i>
                          </a>
                          <a
                            class="dropdown-item format-item"
                            onclick="return insertTags('\'\'\'','\'\'\'','x')"
                          >
                            <i class="fas fa-bold"></i> <b>Bold</b>
                          </a>
                          <a
                            class="dropdown-item format-item"
                            onclick="return insertTags('__','__','x')"
                          >
                            <i class="fas fa-underline"></i> <u>Underline</u>
                          </a>
                          <a
                            class="dropdown-item format-item"
                            onclick="return insertTags('~~','~~','x')"
                          >
                            <i class="fas fa-strikethrough"></i> <s>Strike</s>
                          </a>
                          <div class="dropdown-divider"></div>
                          <a
                            class="dropdown-item format-item"
                            onclick="return insertTags('{','}','x')"
                          >
                            <i class="fas fa-highlighter"></i>
                            <span class="highlight">Highlight</span>
                          </a>
                        </div>
                      </div>
                      <!-- Lists Group -->
                      <div class="nav-item dropdown">
                        <a
                          class="nav-link dropdown-toggle"
                          href="test%3Fm=ADD_FAM.html#"
                          id="listsDropdown"
                          role="button"
                          data-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          {{ _('ul ol dl pre') }}
                        </a>
                        <div
                          class="dropdown-menu"
                          aria-labelledby="listsDropdown"
                        >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('*','','')"
                            >• *ul li<br />
                            • **ul ul li</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('#','','')"
                            >1. #ol li<br />
                            2. ##ol ol li</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags(';x:x','','')"
                            ><strong>;dl dt</strong>:dd</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags(':','','')"
                          >
                            :dl dd<br />
                            ::dl dl dd</a
                          >
                          <a
                            class="dropdown-item font-monospace"
                            onclick="return insertTags('\n\n \n ','\n','')"
                            >&nbsp;pre<br />&nbsp;pre<br
                          /></a>
                        </div>
                      </div>
                      <!-- Miscellaneous notes -->
                      <div class="nav-item dropdown">
                        <a
                          class="nav-link dropdown-toggle"
                          href="test%3Fm=ADD_FAM.html#"
                          id="miscDropdown"
                          role="button"
                          data-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          {{ _('Various notes') }}
                        </a>
                        <div
                          class="dropdown-menu"
                          aria-labelledby="miscDropdown"
                        >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('[[[x:x/x]]]','','')"
                            >[[[directory:filename/texte]]]</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('TITLE=','','')"
                            >TITLE=</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('HEAD=','','')"
                            >HEAD=lui/elle</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('DEATH=','','')"
                            >DEATH=</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('OCCU=','','')"
                            >OCCU=</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('BNOTE=','','')"
                            >BNOTE=</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('NOTE=','','')"
                            >NOTE=</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('BIBLIO=','','')"
                            >BIBLIO=</a
                          >
                        </div>
                      </div>
                      <!-- Visualize/show/hide/summary -->
                      <div class="nav-item dropdown">
                        <a
                          class="nav-link dropdown-toggle"
                          href="test%3Fm=ADD_FAM.html#"
                          id="tocDropdown"
                          role="button"
                          data-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          {{ _('Summary') }}
                        </a>
                        <div
                          class="dropdown-menu"
                          aria-labelledby="tocDropdown"
                        >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('__TOC__','','')"
                            >__TOC__</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('__SHORT_TOC__','','')"
                            >__SHORT_TOC__</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('__NOTOC__','','')"
                            >__NOTOC__</a
                          >
                        </div>
                      </div>
                      <!-- Person/persons -->
                      <div class="nav-item dropdown">
                        <a
                          class="nav-link dropdown-toggle"
                          href="test%3Fm=ADD_FAM.html#"
                          id="personDropdown"
                          role="button"
                          data-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          {{ _('Person') }}
                        </a>
                        <div
                          class="dropdown-menu"
                          aria-labelledby="personDropdown"
                        >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('[[w:',']]','x')"
                            >[[w:magicien]]</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('[[x/x]]','','')"
                            >[[prénom/patronyme]]</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('[[x/x/9/x]]','','')"
                            >[[prénom/patronyme/numéro/ texte href]]</a
                          >
                          <a
                            class="dropdown-item"
                            onclick="return insertTags('[[x/x/9/x;x]]','','')"
                            >[[prénom/patronyme/numéro/ texte href; personne
                            texte href]]</a
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </nav>
              <!-- gw/etc/toolbar.txt --->
            </div>
            <div class="row">
              <div class="d-flex flex-column col-9">
                <textarea
                  class="form-control insert-character-target no-clear-button ml-2"
                  id="notes_comments"
                  name="comment"
                  rows="21"
                ></textarea
                ><button
                  type="submit"
                  class="btn btn-outline-primary btn-lg mx-auto py-3 px-5 my-3"
                  title="{{ _('Validate') }}"
                  aria-label="{{ _('Validate') }}"
                >
                  <span class="font-weight-bold text-uppercase">{{ _('Validate') }}</span
                  ><i
                    class="fa fa-share fa-rotate-180 fa-fw ml-2"
                    aria-hidden="true"
                  ></i>
                </button>
              </div>
              <div class="col mx-2 pl-0 pr-3 py-0">
                <!-- gw/etc/characters.txt --->
                <!-- $Id: characters.txt v7.1 30/11/2023 20:52:12 $ -->
                <!-- $Id: characters.txt v7.1 08/12/2024 09:15:21 $ -->
                <span class="ch text-monospace">
                  <a href="test%3Fm=ADD_FAM.html#" title="En Dash">–</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Em Dash">—</a>
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Left Double Angle Quotation Mark"
                    >«</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="No-Break Space"
                    class="hl"
                    > </a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Right Double Angle Quotation Mark"
                    >»</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Left Single Quotation Mark"
                    >'</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Right Single Quotation Mark"
                    >'</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Double Low-9 Quotation Mark"
                    >„</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Left Double Quotation Mark"
                    >"</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Right Double Quotation Mark"
                    >"</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Narrow No-Break Space"
                    class="hl"
                    > </a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Acute"
                    >Á</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Acute"
                    >á</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Grave"
                    >À</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Grave"
                    >à</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Circumflex"
                    >Â</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Circumflex"
                    >â</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Caron"
                    >Ǎ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Caron"
                    >ǎ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Diaeresis"
                    >Ä</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Diaeresis"
                    >ä</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Dot Above"
                    >Ȧ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Dot Above"
                    >ȧ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Tilde"
                    >Ã</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Tilde"
                    >ã</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Macron"
                    >Ā</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Macron"
                    >ā</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Breve"
                    >Ă</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Breve"
                    >ă</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter A with Ring Above"
                    >Å</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter A with Ring Above"
                    >å</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter AE"
                    >Æ</a
                  >
                  <a href="test%3Fm=ADD_FAM.html#" title="Latin Small Letter AE"
                    >æ</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Acute"
                    >É</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Acute"
                    >é</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Grave"
                    >È</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Grave"
                    >è</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Circumflex"
                    >Ê</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Circumflex"
                    >ê</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Caron"
                    >Ě</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Caron"
                    >ě</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Diaeresis"
                    >Ë</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Diaeresis"
                    >ë</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Dot Above"
                    >Ė</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Dot Above"
                    >ė</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Tilde"
                    >Ẽ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Tilde"
                    >ẽ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter E with Macron"
                    >Ē</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter E with Macron"
                    >ē</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Esh"
                    >Ʃ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Esh"
                    >ʃ</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter I with Acute"
                    >Í</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter I with Acute"
                    >í</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter I with Grave"
                    >Ì</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter I with Grave"
                    >ì</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter I with Circumflex"
                    >Î</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter I with Circumflex"
                    >î</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter I with Caron"
                    >Ǐ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter I with Caron"
                    >ǐ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter I with Diaeresis"
                    >Ï</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter I with Diaeresis"
                    >ï</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter I with Dot Above"
                    >İ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Dotless I"
                    >ı</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter I with Tilde"
                    >Ĩ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter I with Tilde"
                    >ĩ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter IJ"
                    >Ĳ</a
                  >
                  <a href="test%3Fm=ADD_FAM.html#" title="Latin Small Letter IJ"
                    >ĳ</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Acute"
                    >Ó</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Acute"
                    >ó</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Grave"
                    >Ò</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Grave"
                    >ò</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Circumflex"
                    >Ô</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Circumflex"
                    >ô</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Caron"
                    >Ǒ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Caron"
                    >ǒ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Diaeresis"
                    >Ö</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Diaeresis"
                    >ö</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Dot Above"
                    >Ȯ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Dot Above"
                    >ȯ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Tilde"
                    >Õ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Tilde"
                    >õ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Double Acute"
                    >Ő</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Double Acute"
                    >ő</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter O with Stroke"
                    >Ø</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter O with Stroke"
                    >ø</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter OE"
                    >Œ</a
                  >
                  <a href="test%3Fm=ADD_FAM.html#" title="Latin Small Letter OE"
                    >œ</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Acute"
                    >Ú</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Acute"
                    >ú</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Grave"
                    >Ù</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Grave"
                    >ù</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Circumflex"
                    >Û</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Circumflex"
                    >û</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Caron"
                    >Ǔ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Caron"
                    >ǔ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Diaeresis"
                    >Ü</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Diaeresis"
                    >ü</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Tilde"
                    >Ũ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Tilde"
                    >ũ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Ring Above"
                    >Ů</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Ring Above"
                    >ů</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter U with Double Acute"
                    >Ű</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter U with Double Acute"
                    >ű</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Y with Acute"
                    >Ý</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Y with Acute"
                    >ý</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Y with Grave"
                    >Ỳ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Y with Grave"
                    >ỳ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Y with Circumflex"
                    >Ŷ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Y with Circumflex"
                    >ŷ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Y with Diaeresis"
                    >Ÿ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Y with Diaeresis"
                    >ÿ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Y with Dot Above"
                    >Ẏ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Y with Dot Above"
                    >ẏ</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter C with Acute"
                    >Ć</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter C with Acute"
                    >ć</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter C with Cedilla"
                    >Ç</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter C with Cedilla"
                    >ç</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter C with Caron"
                    >Č</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter C with Caron"
                    >č</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter D with Caron"
                    >Ď</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter D with Caron"
                    >ď</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Eth"
                    >Ð</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Eth"
                    >ð</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter N with Acute"
                    >Ń</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter N with Acute"
                    >ń</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter N with Tilde"
                    >Ñ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter N with Tilde"
                    >ñ</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter R with Acute"
                    >Ŕ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter R with Acute"
                    >ŕ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter R with Caron"
                    >Ř</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter R with Caron"
                    >ř</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter S with Acute"
                    >Ś</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter S with Acute"
                    >ś</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter S with Caron"
                    >Š</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter S with Caron"
                    >š</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Sharp S"
                    >ß</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter T with Caron"
                    >Ť</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter T with Caron"
                    >ť</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter T with Cedilla"
                    >Ţ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter T with Cedilla"
                    >ţ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Thorn"
                    >Þ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Thorn"
                    >þ</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Z with Acute"
                    >Ź</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Z with Acute"
                    >ź</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Z with Caron"
                    >Ž</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Z with Caron"
                    >ž</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Capital Letter Z with Dot Above"
                    >Ż</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Latin Small Letter Z with Dot Above"
                    >ż</a
                  >
                  <br />
                  <a href="test%3Fm=ADD_FAM.html#" title="Superscript One">¹</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Superscript Two">²</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Superscript Three"
                    >³</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Vulgar Fraction One Half"
                    >½</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Vulgar Fraction One Quarter"
                    >¼</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Vulgar Fraction Three Quarters"
                    >¾</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Masculine Ordinal Indicator"
                    >º</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Feminine Ordinal Indicator"
                    >ª</a
                  >
                  <br />
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Inverted Exclamation Mark"
                    >¡</a
                  >
                  <a
                    href="test%3Fm=ADD_FAM.html#"
                    title="Inverted Question Mark"
                    >¿</a
                  >
                  <a href="test%3Fm=ADD_FAM.html#" title="Bullet">•</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Middle Dot">·</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Multiplication Sign"
                    >×</a
                  >
                  <a href="test%3Fm=ADD_FAM.html#" title="Division Sign">÷</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Euro Sign">€</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Pound Sign">£</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Copyright Sign">©</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Registered Sign">®</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Per Mille Sign">‰</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Degree Sign">°</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Micro Sign">µ</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Pilcrow Sign">¶</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Section Sign">§</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Dagger">†</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Double Dagger">‡</a>
                  <a href="test%3Fm=ADD_FAM.html#" title="Numero Sign"
                    >№</a
                  > </span
                ><!-- gw/etc/characters.txt --->
              </div>
            </div>
          </div>
        </div>
      </form>
      <!-- gw/etc/trl.txt --->
      <!-- gw/etc/trl.txt --->
      <!-- gw/etc/copyr.txt --->
      <!-- $Id: copyr.txt 7.1-beta 18/12/2023 22:03:44 $ -->
      <div
        class="d-flex flex-row justify-content-center justify-content-lg-end my-2"
        id="copyr"
      >
        <div class="d-flex flex-wrap justify-content-md-end">
          <!-- legal notices -->
          <!-- Language selector and connections info -->
          <div class="d-flex flex-row align-items-lg-end mt-0 ml-3 border-0">
            <div
              class="btn-group dropup"
              data-toggle="tooltip"
              data-placement="left"
              title="français – Sélectionner la langue"
            >
              <button
                class="btn btn-link dropdown-toggle"
                type="button"
                id="dropdownMenu1"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <span class="sr-only">lang</span>
                <span class="text-uppercase">{{ lang }}</span>
                <span class="sr-only">, sélectionner la langue</span>
              </button>
              <div
                class="dropdown-menu scrollable-lang"
                aria-labelledby="dropdownMenu1"
              >
                <a
                  class="dropdown-item"
                  id="lang_af"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='af') }}"
                  ><code>af&nbsp;&nbsp;&nbsp; </code>Afrikaans</a
                >
                <a
                  class="dropdown-item"
                  id="lang_ar"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='ar') }}"
                  ><code>ar&nbsp;&nbsp;&nbsp; </code>Arabe</a
                >
                <a
                  class="dropdown-item"
                  id="lang_bg"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='bg') }}"
                  ><code>bg&nbsp;&nbsp;&nbsp; </code>Bulgare</a
                >
                <a
                  class="dropdown-item"
                  id="lang_br"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='br') }}"
                  ><code>br&nbsp;&nbsp;&nbsp; </code>Breton</a
                >
                <a
                  class="dropdown-item"
                  id="lang_ca"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='ca') }}"
                  ><code>ca&nbsp;&nbsp;&nbsp; </code>Catalan</a
                >
                <a
                  class="dropdown-item"
                  id="lang_co"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='co') }}"
                  ><code>co&nbsp;&nbsp;&nbsp; </code>Corse</a
                >
                <a
                  class="dropdown-item"
                  id="lang_cs"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='cs') }}"
                  ><code>cs&nbsp;&nbsp;&nbsp; </code>Tchèque</a
                >
                <a
                  class="dropdown-item"
                  id="lang_da"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='da') }}"
                  ><code>da&nbsp;&nbsp;&nbsp; </code>Danois</a
                >
                <a
                  class="dropdown-item"
                  id="lang_de"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='de') }}"
                  ><code>de&nbsp;&nbsp;&nbsp; </code>Allemand</a
                >
                <a
                  class="dropdown-item"
                  id="lang_en"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='en') }}"
                  ><code>en&nbsp;&nbsp;&nbsp; </code>Anglais</a
                >
                <a
                  class="dropdown-item"
                  id="lang_eo"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='eo') }}"
                  ><code>eo&nbsp;&nbsp;&nbsp; </code>Espéranto</a
                >
                <a
                  class="dropdown-item"
                  id="lang_es"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='es') }}"
                  ><code>es&nbsp;&nbsp;&nbsp; </code>Espagnol</a
                >
                <a
                  class="dropdown-item"
                  id="lang_et"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='et') }}"
                  ><code>et&nbsp;&nbsp;&nbsp; </code>Estonien</a
                >
                <a
                  class="dropdown-item"
                  id="lang_fi"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='fi') }}"
                  ><code>fi&nbsp;&nbsp;&nbsp; </code>Finnois</a
                >
                <a
                  class="dropdown-item"
                  id="lang_he"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='he') }}"
                  ><code>he&nbsp;&nbsp;&nbsp; </code>Hébreu</a
                >
                <a
                  class="dropdown-item"
                  id="lang_is"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='is') }}"
                  ><code>is&nbsp;&nbsp;&nbsp; </code>Islandais</a
                >
                <a
                  class="dropdown-item"
                  id="lang_it"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='it') }}"
                  ><code>it&nbsp;&nbsp;&nbsp; </code>Italien</a
                >
                <a
                  class="dropdown-item"
                  id="lang_lt"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='lt') }}"
                  ><code>lt&nbsp;&nbsp;&nbsp; </code>Lituanien</a
                >
                <a
                  class="dropdown-item"
                  id="lang_lv"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='lv') }}"
                  ><code>lv&nbsp;&nbsp;&nbsp; </code>Letton</a
                >
                <a
                  class="dropdown-item"
                  id="lang_nl"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='nl') }}"
                  ><code>nl&nbsp;&nbsp;&nbsp; </code>Néerlandais</a
                >
                <a
                  class="dropdown-item"
                  id="lang_no"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='no') }}"
                  ><code>no&nbsp;&nbsp;&nbsp; </code>Norvégien</a
                >
                <a
                  class="dropdown-item"
                  id="lang_oc"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='oc') }}"
                  ><code>oc&nbsp;&nbsp;&nbsp; </code>Occitan</a
                >
                <a
                  class="dropdown-item"
                  id="lang_pl"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='pl') }}"
                  ><code>pl&nbsp;&nbsp;&nbsp; </code>Polonais</a
                >
                <a
                  class="dropdown-item"
                  id="lang_pt"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='pt') }}"
                  ><code>pt&nbsp;&nbsp;&nbsp; </code>Portugais</a
                >
                <a
                  class="dropdown-item"
                  id="lang_pt-br"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='pt-br') }}"
                  ><code>pt-br </code>Portugais brésilien</a
                >
                <a
                  class="dropdown-item"
                  id="lang_ro"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='ro') }}"
                  ><code>ro&nbsp;&nbsp;&nbsp; </code>Roumain</a
                >
                <a
                  class="dropdown-item"
                  id="lang_ru"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='ru') }}"
                  ><code>ru&nbsp;&nbsp;&nbsp; </code>Russe</a
                >
                <a
                  class="dropdown-item"
                  id="lang_sk"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='sk') }}"
                  ><code>sk&nbsp;&nbsp;&nbsp; </code>Slovaque</a
                >
                <a
                  class="dropdown-item"
                  id="lang_sl"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='sl') }}"
                  ><code>sl&nbsp;&nbsp;&nbsp; </code>Slovène</a
                >
                <a
                  class="dropdown-item"
                  id="lang_sv"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='sv') }}"
                  ><code>sv&nbsp;&nbsp;&nbsp; </code>Suédois</a
                >
                <a
                  class="dropdown-item"
                  id="lang_tr"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='tr') }}"
                  ><code>tr&nbsp;&nbsp;&nbsp; </code>Turc</a
                >
                <a
                  class="dropdown-item"
                  id="lang_zh"
                  href="{{ url_for('gwd.route_ADD_FAM', base=base, lang='zh') }}"
                  ><code>zh&nbsp;&nbsp;&nbsp; </code>Chinois</a
                >
              </div>
            </div>
            <!-- Connections info -->
          </div>
          <!-- Footer links and copyright -->
          <div
            class="d-flex flex-column justify-content-md-end align-self-center ml-1 ml-md-3 ml-lg-4"
          >
            <div class="ml-auto mb-0">
              <!-- TODO: Template switcher - implement templ parameter handling in Flask routes -->
              <a
                role="button"
                class="mr-1"
                href="{{ url_for('gwd.route_ADD_FAM', base=base, lang=lang, templ='templm') }}"
                data-toggle="tooltip"
                title="templm"
              >
                <i class="fab fa-markdown" aria-hidden="true"></i>
                <span class="sr-only">switch to templm</span>
              </a>
              <a
                href="https://github.com/geneweb/geneweb/tree/2ce17dddc"
                data-toggle="tooltip"
                data-html="true"
                title="Branche master compilée le 2025-09-05<br>à partir du commit id 2ce17dddc (2025-08-24)"
              >
                GeneWeb v. 7.1-beta</a
              >
            </div>
            <div class="btn-group mt-0">
              <span
                >&copy;
                <a
                  href="https://www.inria.fr"
                  target="_blank"
                  rel="noreferrer, noopener"
                  >INRIA</a
                >
                1998-2007</span
              >
              <a
                href="https://geneweb.tuxfamily.org/wiki/GeneWeb/fr"
                class="ml-1"
                target="_blank"
                rel="noreferrer, noopener"
                data-toggle="tooltip"
                title="GeneWeb Wiki"
              >
                <i class="fab fa-wikipedia-w"></i>
              </a>
              <a
                href="https://github.com/geneweb/geneweb"
                class="ml-1"
                target="_blank"
                rel="noreferrer, noopener"
                data-toggle="tooltip"
                title="GeneWeb Github"
              >
                <i class="fab fa-github"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
      <!-- gw/etc/copyr.txt --->
    </div>
    <!-- gw/etc/js.txt --->
    <!-- $Id: js.txt v7.1 10/01/2025 04:15:45 $ -->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script>
      $("body").scrollspy({ target: "#banner" });
    </script>
    <script src="{{ url_for('static', filename='js/autosize.min.js') }}"></script>
    <script>
      autosize(document.querySelectorAll("textarea"));
    </script>
    <script>
      // Attach a click event listener to each anchor element within the character's list container
      function setupCharacterInsertion() {
        document.querySelectorAll(".ch a").forEach(function (element) {
          element.addEventListener("click", function (event) {
            event.preventDefault();
            var textarea = document.querySelector(".insert-character-target");
            insertCharacter(textarea, this.innerText);
          });
        });
      }
      // Function to insert a character at the current cursor position in a textarea
      function insertCharacter(t, v) {
        var startPos = t.selectionStart;
        var endPos = t.selectionEnd;
        t.value =
          t.value.substring(0, startPos) +
          v +
          t.value.substring(endPos, t.value.length);
        t.selectionStart = startPos + v.length;
        t.selectionEnd = t.selectionStart;
        t.focus();
      }
      function insertTags(tagOpen, tagClose, sampleText) {
        const textarea = document.querySelector("textarea#notes_comments");
        if (!textarea) return false;
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const scrollTop = textarea.scrollTop;
        let selectedText = textarea.value.substring(start, end);
        if (!selectedText) selectedText = sampleText;
        // Remove trailing space if exists
        if (selectedText.endsWith(" ")) {
          selectedText = selectedText.slice(0, -1);
          const text = textarea.value;
          const before = text.substring(0, start);
          const after = text.substring(end);
          textarea.value =
            before + tagOpen + selectedText + tagClose + " " + after;
        } else {
          const text = textarea.value;
          const before = text.substring(0, start);
          const after = text.substring(end);
          textarea.value = before + tagOpen + selectedText + tagClose + after;
        }
        // Restore scroll position
        textarea.scrollTop = scrollTop;
        // Set selection
        if (start === end) {
          // No text was selected
          const cursorPos = start + tagOpen.length;
          textarea.setSelectionRange(cursorPos, cursorPos + sampleText.length);
        } else {
          // Text was selected
          const newCursorPos =
            start + tagOpen.length + selectedText.length + tagClose.length;
          textarea.setSelectionRange(newCursorPos, newCursorPos);
        }
        textarea.focus();
        return false;
      }
      // Toolbar sticky behavior
      function setupToolbarSticky() {
        const toolbar = document.querySelector(".toolbar-wrapper");
        if (!toolbar) return;
        let lastScroll = window.scrollY;
        function handleScroll() {
          const currentScroll = window.scrollY;
          if (currentScroll > 0) {
            toolbar.classList.add("is-sticky");
          } else {
            toolbar.classList.remove("is-sticky");
          }
          lastScroll = currentScroll;
        }
        window.addEventListener("scroll", handleScroll, { passive: true });
      }
    </script>
    <script>
      // Enhanced clear button management for dynamic input fields
      // Add clear buttons (X) to input fields and handle DataTable updates
      // Generic clear button functionality for form inputs
      function addClearButtonToInputs() {
        // Utility function to create and setup clear button
        function createClearButton(element) {
          const clearButton = document.createElement("i");
          clearButton.className = "fas fa-xmark clear-button-icon";
          clearButton.title = "Effacer le champ";
          clearButton.style.cssText = `
position: absolute;
right: 10px;
top: ${element.tagName.toLowerCase() === "textarea" ? "10px" : "50%"};
transform: ${
            element.tagName.toLowerCase() === "textarea"
              ? "none"
              : "translateY(-50%)"
          };
cursor: pointer;
color: #667fc9;
font-size: 1em;
opacity: 0;
transition: opacity 0.2s ease-in-out, color 0.2s ease-in-out;
pointer-events: auto;
`;
          return clearButton;
        }
        // Initialize or update a single input
        function initializeInput(element) {
          // Skip if already initialized
          if (element.dataset.clearInitialized) {
            const existingButton =
              element.parentNode.querySelector(".clear-button-icon");
            if (existingButton) {
              existingButton.style.opacity = element.value ? "1" : "0";
            }
            return;
          }
          // Mark as initialized
          element.dataset.clearInitialized = "true";
          // Create wrapper if needed
          let wrapper = element.parentNode;
          if (!wrapper.classList.contains("clear-button-wrapper")) {
            wrapper = document.createElement("div");
            wrapper.className = "clear-button-wrapper";
            wrapper.style.cssText =
              "position:relative;display:inline-block;width:100%";
            element.parentNode.insertBefore(wrapper, element);
            wrapper.appendChild(element);
          }
          // Add padding for the clear button
          element.style.paddingRight = "24px";
          // Create and append clear button
          const clearButton = createClearButton(element);
          wrapper.appendChild(clearButton);
          // Update clear button visibility
          const updateVisibility = () => {
            requestAnimationFrame(() => {
              clearButton.style.opacity = element.value ? "1" : "0";
            });
          };
          // Event listeners
          element.addEventListener("input", updateVisibility);
          element.addEventListener("change", updateVisibility);
          element.addEventListener("focus", updateVisibility);
          // Hover effects
          clearButton.addEventListener(
            "mouseenter",
            () => (clearButton.style.color = "#335599")
          );
          clearButton.addEventListener(
            "mouseleave",
            () => (clearButton.style.color = "#667fc9")
          );
          // Handle clear button click
          clearButton.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            // Clear the input
            element.value = "";
            element.focus();
            updateVisibility();
            // Trigger events
            const inputEvent = new CustomEvent("clearButton", {
              bubbles: true,
              detail: { element },
            });
            element.dispatchEvent(inputEvent);
            element.dispatchEvent(new Event("input", { bubbles: true }));
            element.dispatchEvent(new Event("change", { bubbles: true }));
          });
          // Initial visibility state
          updateVisibility();
        }
        // Process all matching inputs
        function processInputs() {
          const selector = `
input[type="text"]:not(.no-clear-button):not([readonly]):not([disabled]),
input[type="search"]:not(.no-clear-button):not([readonly]):not([disabled]),
textarea:not(.no-clear-button):not([readonly]):not([disabled]),
.clear-button:not([readonly]):not([disabled])
`;
          requestAnimationFrame(() => {
            document.querySelectorAll(selector).forEach(initializeInput);
          });
        }
        // Initial processing
        processInputs();
        // Monitor DOM changes
        const observer = new MutationObserver((mutations) => {
          let shouldProcess = false;
          mutations.forEach((mutation) => {
            if (
              mutation.addedNodes.length ||
              (mutation.type === "attributes" &&
                (mutation.attributeName === "type" ||
                  mutation.attributeName === "class"))
            ) {
              shouldProcess = true;
            }
          });
          if (shouldProcess) {
            processInputs();
          }
        });
        observer.observe(document.body, {
          childList: true,
          subtree: true,
          attributes: true,
          attributeFilter: ["type", "class"],
        });
      }
    </script>
    <script>
      // Manages enhanced input field behaviors (navigation, interaction)
      const inputToBook = {
        addNavigation: function () {
          // Use event delegation for dynamically added inputs
          $(document).on("mousedown", "input[data-book]", function (event) {
            if (event.ctrlKey && event.button === 0) {
              event.preventDefault();
              inputToBook.openBook(this.value, $(this).data("book"));
            }
          });
        },
        openBook: function (value, book) {
          if (!value) return;
          let preVal = value;
          if (book === "place") {
            const place = value.split(/\]\s+[-–—]\s+/);
            preVal = place.length > 1 ? place[1] : value;
          }
          preVal = preVal
            .substring(0, Math.min(preVal.length, 12))
            .split(/[, ]+/)[0]
            .substring(0, Math.floor(value.length / 2));
          const encVal = encodeURIComponent(value);
          const encPreVal = encodeURIComponent(preVal);
          // TODO: Implement MOD_DATA route in Flask - for now using relative URL
          const url = `/gwd/{{ base }}/MOD_DATA/?w=w&data=${book}&s=${encPreVal}&s1=${
            encVal !== encPreVal ? encVal : ""
          }`;
          window.open(url, "_blank");
        },
      };
      function initializeLazyModules() {
        $("#load_once_p_mod").one("click", () =>
          $.getScript("{{ url_for('static', filename='js/p_mod.js') }}")
        );
        $("#load_once_copylink").one("click", () =>
          $.getScript("{{ url_for('static', filename='js/copylink.js') }}")
        );
        $("#load_once_rlm_builder").one("click", () =>
          $.getScript("{{ url_for('static', filename='js/rlm_builder.js') }}")
        );
      }
      // Focus on found autofocus input in opening BS modal
      function setupModalAutofocus() {
        $(".modal").on("shown.bs.modal", function () {
          $(this).find("[autofocus]").focus();
        });
      }
      // Floating placeholders for all textual inputs
      function setupFloatingPlaceholders() {
        const inputs = document.querySelectorAll(
          'input[type="text"][placeholder], input[type="number"][placeholder], input[type="search"][placeholder], textarea[placeholder]'
        );
        inputs.forEach((input) => {
          // Ignore placeholders that are only non-breaking spaces
          if (input.placeholder.trim() === "") return;
          const hadFocus = document.activeElement === input;
          const wrapper = document.createElement("div");
          wrapper.className = "input-wrapper";
          input.parentNode.insertBefore(wrapper, input);
          wrapper.appendChild(input);
          const placeholder = document.createElement("span");
          placeholder.className = "floating-placeholder";
          placeholder.textContent = input.placeholder;
          wrapper.appendChild(placeholder);
          input.addEventListener("focus", () =>
            placeholder.classList.add("active")
          );
          input.addEventListener("blur", () =>
            placeholder.classList.remove("active")
          );
          if (hadFocus || input.hasAttribute("autofocus")) {
            requestAnimationFrame(() => {
              input.focus();
              placeholder.classList.add("active");
            });
          }
        });
      }
      const initTooltips = () => {
        const tooltipElements = document.querySelectorAll(
          '[data-toggle="tooltip"]'
        );
        if (tooltipElements.length > 0) {
          $(tooltipElements).tooltip({
            trigger: "hover",
            delay: { show: 200, hide: 50 },
            container: "body",
          });
        }
      };
      function safeInitialize(fn) {
        try {
          fn();
        } catch (error) {
          console.error("Initialization error:", error);
        }
      }
      document.addEventListener("DOMContentLoaded", () => {
        initializeLazyModules();
        setupModalAutofocus();
        setupFloatingPlaceholders();
        setupToolbarSticky();
        setupCharacterInsertion();
      });
    </script>
    <!-- gw/etc/js.txt --->
    <script>
      var q_time = 0.016;
      var nb_errors = 0;
      var errors_list = "\u{000A}";
      var home_time = document.getElementById("q_time");
      var home_errors = document.getElementById("nb_errors");
      if (home_time != null) {
        home_time.title = "Query treated in " + q_time + " s";
        if (q_time < 3) {
          home_time.classList.add("text-success");
        } else if (q_time < 8) {
          home_time.classList.add("text-warning");
        } else {
          home_time.classList.add("text-danger");
        }
      }
      if (home_errors != null) {
        if (nb_errors > 0) {
          home_errors.title = nb_errors + " error(s)!";
          home_errors.classList.remove("d-none");
        }
        if (errors_list != "\u{000A}") {
          home_errors.title = home_errors.title + errors_list + ".";
        }
      }
    </script>
    <!-- gw/etc/upd_js.txt --->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        addClearButtonToInputs();
        inputToBook.addNavigation();
        populateDatalists();
      });
      $(document).ready(function () {
        $("[id$=_selct]")
          .on("change", function () {
            var pre = "#" + this.id;
            var all = pre + "_data, " + pre + "_sex";
            var mod = pre + "_mod";
            var isLink = this.value === "link";
            $(all).toggle(!isLink);
            $(mod).toggle(isLink);
          })
          .change();
      });
      document.addEventListener("scroll", function () {
        const banner = document.getElementById("banner");
        if (window.scrollY > 35) {
          banner.classList.add("scrolled");
        } else {
          banner.classList.remove("scrolled");
        }
      });
      <!--
      function changeCalendar(e, v, m, c) {
        // Convert month value to numeric if it's a string
        var mv = m;

        // Handle French Republican calendar abbreviations
        switch (m) {
          case "VD":
            mv = 1;
            break;
          case "BR":
            mv = 2;
            break;
          case "FM":
            mv = 3;
            break;
          case "NI":
            mv = 4;
            break;
          case "PL":
            mv = 5;
            break;
          case "VT":
            mv = 6;
            break;
          case "GE":
            mv = 7;
            break;
          case "FL":
            mv = 8;
            break;
          case "PR":
            mv = 9;
            break;
          case "ME":
            mv = 10;
            break;
          case "TH":
            mv = 11;
            break;
          case "FT":
            mv = 12;
            break;
          case "JC":
            mv = 13;
            break;
        }
        
        // Convert to string for comparison (form values are strings)
        mv = String(mv);
        
        const calType = c.options[c.selectedIndex].value;
        let months = [];
        
        switch (calType) {
          case "G":
          case "J":
            months = calendarTranslations.gregorian;
            break;
          case "F":
            months = calendarTranslations.french;
            break;
          case "H":
            months = calendarTranslations.hebrew;
            break;
        }
        
        if (months.length === 0) return;
        
        const options = months.map(month => 
          `<option value="${month.value}"${mv === month.value ? ' selected' : ''}>${month.label}</option>`
        ).join('');
        
        document.getElementById(e).innerHTML = 
          `<select class="form-control pl-sm-1 pr-lg-0 px-xl-2 ml-sm-2 ml-md-3" name="${v}">${options}</select>`;
      }
      -->
    </script>
    <!-- gw/etc/upd_js.txt --->
    <script>
      // Translated calendar month names
      const calendarTranslations = {
        gregorian: [
          { value: "", label: "-" },
          { value: "1", label: "{{ _('January') }}" },
          { value: "2", label: "{{ _('February') }}" },
          { value: "3", label: "{{ _('March') }}" },
          { value: "4", label: "{{ _('April') }}" },
          { value: "5", label: "{{ _('May') }}" },
          { value: "6", label: "{{ _('June') }}" },
          { value: "7", label: "{{ _('July') }}" },
          { value: "8", label: "{{ _('August') }}" },
          { value: "9", label: "{{ _('September') }}" },
          { value: "10", label: "{{ _('October') }}" },
          { value: "11", label: "{{ _('November') }}" },
          { value: "12", label: "{{ _('December') }}" }
        ],
        french: [
          { value: "", label: "-" },
          { value: "1", label: "{{ _('Vendémiaire') }}" },
          { value: "2", label: "{{ _('Brumaire') }}" },
          { value: "3", label: "{{ _('Frimaire') }}" },
          { value: "4", label: "{{ _('Nivôse') }}" },
          { value: "5", label: "{{ _('Pluviôse') }}" },
          { value: "6", label: "{{ _('Ventôse') }}" },
          { value: "7", label: "{{ _('Germinal') }}" },
          { value: "8", label: "{{ _('Floréal') }}" },
          { value: "9", label: "{{ _('Prairial') }}" },
          { value: "10", label: "{{ _('Messidor') }}" },
          { value: "11", label: "{{ _('Thermidor') }}" },
          { value: "12", label: "{{ _('Fructidor') }}" },
          { value: "13", label: "{{ _('Complémentaire') }}" }
        ],
        hebrew: [
          { value: "", label: "-" },
          { value: "1", label: "{{ _('Tichri') }}" },
          { value: "2", label: "{{ _('Marhechvan') }}" },
          { value: "3", label: "{{ _('Kislev') }}" },
          { value: "4", label: "{{ _('Tevet') }}" },
          { value: "5", label: "{{ _('Chevat') }}" },
          { value: "6", label: "{{ _('Adar 1') }}" },
          { value: "7", label: "{{ _('Adar 2') }}" },
          { value: "8", label: "{{ _('Nissan') }}" },
          { value: "9", label: "{{ _('Iyar') }}" },
          { value: "10", label: "{{ _('Sivan') }}" },
          { value: "11", label: "{{ _('Tamouz') }}" },
          { value: "12", label: "{{ _('Av') }}" },
          { value: "13", label: "{{ _('Eloul') }}" }
        ]
      };

      function show_fevent_label(xxname, xcnt) {
        var selector = document.getElementById("fevent_select" + xcnt);
        var label = document.getElementById("fevent_label_selector" + xcnt);
        var input = document.getElementById("e_name" + xcnt);
        if (selector.value == "") {
          if (xxname.charAt(0) != "#" && xxname != "") {
            input.value = xxname;
          } else {
            input.value = "";
          }
        } else {
          input.value = selector.value;
        }
        if (selector.options[selector.selectedIndex].id === "custom" + xcnt) {
          label.style.display = "inline";
          input.style.display = "inline";
        } else {
          label.style.display = "none";
          input.style.display = "none";
        }
      }
      $(document).ready(function () {
        //show evt perso
        $(".other_evts").each(function () {
          var inp = $(this).find("input").first();
          if (inp.val().charAt(0) != "#" && inp.val() != "") {
            $(this).show();
          }
        });
      });
    </script>
    <script>
      $(document).ready(function () {
        var targetId = $("#updfam").data("insert").split("/")[0];
        if (!targetId) {
          var $inputs = $("#updfam").find('input[type="text"]');
          targetId = $inputs
            .filter(function () {
              return (
                (this.id.startsWith("e_place") || this.id.endsWith("_fn")) &&
                this.value === ""
              );
            })
            .first()
            .attr("id");
        }
        if (targetId) {
          $("#" + targetId).focus();
        }
      });
      
      // Handle dynamic insertion of children, events, and witnesses
      $(document).ready(function() {
        let eventCounter = 1;

        // Attach event handlers (delegated) for events/witnesses. Kept as a named function
        // so earlier code can call it; main handlers use delegation so this is a no-op.
        function attachEventHandlers() {
          console.debug('attachEventHandlers: delegated handlers are active');
        }

        function handleEventInsertion($button, $checkbox) {
          const $insertRow = $button.closest('.row');
          const $select = $insertRow.find('select').first();
          const numToInsert = parseInt($select.val()) || 1;
          for (let i = 0; i < numToInsert; i++) {
            eventCounter++;
            const $newEvent = createEventForm(eventCounter);
            $insertRow.before($newEvent);
          }
          // no-op: delegated handlers cover witness buttons
        }

        function handleWitnessInsertion($button, $checkbox) {
          const name = $checkbox.attr('name') || '';
          const m = name.match(/^e(\d+)_ins_witn(\d+)$/);
          if (!m) return;
          const eventNum = m[1];
          const afterWitnNum = parseInt(m[2]);
          const selectName = `e${eventNum}_ins_witn${afterWitnNum}_n`;
          const numToInsert = parseInt($(`select[name="${selectName}"]`).val()) || 1;

          // find insert row for witnesses (closest row)
          const $insertRow = $button.closest('.row').parent().closest('.row');

          // determine current max witness index for this event
          let witnessCounter = 0;
          $(`[name^="e${eventNum}_witn"]`).each(function() {
            const nm = $(this).attr('name').match(new RegExp(`^e${eventNum}_witn(\\d+)`));
            if (nm) witnessCounter = Math.max(witnessCounter, parseInt(nm[1]));
          });

          for (let i = 0; i < numToInsert; i++) {
            witnessCounter++;
            const $newWitness = createWitnessForm(eventNum, witnessCounter);
            $insertRow.before($newWitness);
          }
          // Bind create/link toggle for newly created witnesses
          bindWitnessToggleHandlers();
        }

        // Normalize the existing child markup into .child-row wrappers and insert insert-rows
        function normalizeChildStructure() {
          const $childrenCardBody = $('#children').closest('.card').find('.card-body').first();
          if (!$childrenCardBody.length) return;

          const $allChildren = $childrenCardBody.children().toArray();
          const wrappers = [];

          for (let i = 0; i < $allChildren.length; i++) {
            const $elem = $($allChildren[i]);
            // Language-agnostic child header detection:
            // either a row containing the child select (id starts with ch and ends with _p_selct)
            // or a row with an h5 that contains a localized child label (fallback to regex check)
            let isChildHeader = false;
            if ($elem.hasClass('row')) {
              const $sel = $elem.find('select[id$="_p_selct"]').first();
              if ($sel.length && /^ch\d+_p_selct$/.test($sel.attr('id') || '')) {
                isChildHeader = true;
              } else {
                const $h5 = $elem.find('h5').first();
                if ($h5.length) {
                  const txt = ($h5.text() || '').trim();
                  // Match common localized words for child header (Child/Enfant)
                  if (/\b(Child|Enfant)\b/i.test(txt)) isChildHeader = true;
                }
              }
            }
            if (isChildHeader) {
              // Start collecting all elements belonging to this child
              const block = [];
              let j = i;
              block.push($allChildren[j]);
              j++;
              // Continue until we hit the next child header or run out of elements
              while (j < $allChildren.length) {
                const $next = $($allChildren[j]);
                // Check if this is another child header row
                let nextIsHeader = false;
                if ($next.hasClass('row')) {
                  const $nsel = $next.find('select[id$="_p_selct"]').first();
                  if ($nsel.length && /^ch\d+_p_selct$/.test($nsel.attr('id') || '')) nextIsHeader = true;
                  else {
                    const $nh5 = $next.find('h5').first();
                    if ($nh5.length) {
                      const ntxt = ($nh5.text() || '').trim();
                      if (/\b(Child|Enfant)\b/i.test(ntxt)) nextIsHeader = true;
                    }
                  }
                }
                if (nextIsHeader) break;
                block.push($allChildren[j]);
                j++;
              }
              // Create wrapper and move all child's elements into it
              const $wrap = $('<div class="child-row" data-child-index="0"></div>');
              block.forEach(function(node) { $wrap.append(node); });
              wrappers.push($wrap);
              i = j - 1;
            }
          }

          if (wrappers.length === 0) return;

          // Clear out the old content in the card-body and rebuild with insert rows interleaved
          $childrenCardBody.empty();

          // Insert wrappers and insert-rows interleaved: insert-row before each child, then after last
          wrappers.forEach(function($w, idx) {
            $childrenCardBody.append(createInsertChildRow(idx)); // insert BEFORE child idx
            $childrenCardBody.append($w);
          });
          // Final insert row after last child
          $childrenCardBody.append(createInsertChildRow(wrappers.length));
        }

        // Intercept insert buttons that have been created by createInsertChildRow
        $(document).on('click', '.child-insert-btn', function(e) {
          e.preventDefault();
          e.stopPropagation();
          const $btn = $(this);
          const afterIdx = parseInt($btn.data('after')) || 0;
          const $select = $btn.closest('.insert-row').find('select');
          const numToInsert = parseInt($select.val()) || 1;
          handleChildInsertion(afterIdx, numToInsert);
          return false;
        });

        // Intercept event/witness insert buttons (keeps existing checkbox behaviour)
        $(document).on('click', 'button[title*="Insérer témoin"]', function(e) {
          const $button = $(this);
          const $checkbox = $button.siblings('label').find('input[type="checkbox"]');
          if (!$checkbox.is(':checked')) return true;
          e.preventDefault();
          handleWitnessInsertion($button, $checkbox);
          $checkbox.prop('checked', false);
          return false;
        });

        $(document).on('click', 'button[title*="Insérer événement"]', function(e) {
          const $button = $(this);
          const $checkbox = $button.siblings('label').find('input[type="checkbox"]');
          if (!$checkbox.is(':checked')) return true;
          e.preventDefault();
          handleEventInsertion($button, $checkbox);
          $checkbox.prop('checked', false);
          return false;
        });

        // Handle child swap button clicks
        $(document).on('click', '.child-swap-btn', function(e) {
          e.preventDefault();
          e.stopPropagation();
          const $btn = $(this);
          const childIndex = parseInt($btn.data('child-index')) || 0;
          
          if (childIndex <= 1) return false; // First child can't swap
          
          const $childrenCardBody = $('#children').closest('.card').find('.card-body').first();
          if (!$childrenCardBody.length) return false;
          
          const $wrappers = $childrenCardBody.children('.child-row');
          const $current = $wrappers.eq(childIndex - 1); // 0-indexed
          const $previous = $wrappers.eq(childIndex - 2);
          
          if ($current.length && $previous.length) {
            // Swap: move current before previous
            $previous.before($current.detach());
            
            // Rebuild everything
            renumberAllChildren();
            rebuildInsertRows();
            rebuildSwapButtons();
            bindChildToggleHandlers();
          }
          
          return false;
        });

        function handleChildInsertion(afterIndex, numToInsert) {
          const $childrenCardBody = $('#children').closest('.card').find('.card-body').first();
          if (!$childrenCardBody.length) return;

          // Find current child wrappers
          const $wrappers = $childrenCardBody.children('.child-row');

          // Determine insertion point
          // afterIndex 0 -> before first child
          // afterIndex N -> after Nth child
          if (afterIndex === 0) {
            // Insert BEFORE first child
            const $firstChild = $wrappers.first();
            for (let i = 0; i < numToInsert; i++) {
              const $newWrap = createChildForm('X');
              if ($firstChild.length) {
                $firstChild.before($newWrap);
              } else {
                // No children yet, append to card body
                $childrenCardBody.append($newWrap);
              }
            }
          } else {
            // Insert AFTER the Nth child
            let $anchor = $wrappers.eq(afterIndex - 1);
            for (let i = 0; i < numToInsert; i++) {
              const $newWrap = createChildForm('X');
              if ($anchor.length) {
                $anchor.after($newWrap);
                $anchor = $newWrap; // next insertion comes after this one
              } else {
                // Fallback: append at end
                $childrenCardBody.append($newWrap);
              }
            }
          }

          // After insertion, rebuild insert-rows and renumber children
          rebuildInsertRows();
          renumberAllChildren();
          rebuildSwapButtons();
          // Re-bind the create/link toggle for newly created children
          bindChildToggleHandlers();
        }

        function renumberAllChildren() {
          const $childrenCardBody = $('#children').closest('.card').find('.card-body').first();
          if (!$childrenCardBody.length) return;

          const $wrappers = $childrenCardBody.children('.child-row');
          // Localized ordinals rendered at template time
          const ordinals = ['', '{{ _("1st") }}', '{{ _("2nd") }}', '{{ _("3rd") }}', '{{ _("4th") }}', '{{ _("5th") }}', '{{ _("6th") }}', '{{ _("7th") }}', '{{ _("8th") }}', '{{ _("9th") }}', '{{ _("10th") }}'];

          $wrappers.each(function(i) {
            const newNum = i + 1;
            const $w = $(this);
            $w.attr('data-child-index', newNum);

            // Update header text
            const ordinal = newNum < ordinals.length ? ordinals[newNum] : newNum + '';
            $w.find('h5').first().html(`<span class="text-uppercase">${ordinal} {{ _("Child") }}</span>`);

            // Replace placeholder names (chX_) or numeric chN_ to ch{newNum}_ within this wrapper
            $w.find('*').each(function() {
              const $el = $(this);
              // name
              const name = $el.attr('name');
              if (name) {
                const newName = name.replace(/ch(?:X|\d+)/g, 'ch' + newNum);
                if (newName !== name) $el.attr('name', newName);
              }
              // id
              const id = $el.attr('id');
              if (id) {
                const newId = id.replace(/ch(?:X|\d+)/g, 'ch' + newNum);
                if (newId !== id) $el.attr('id', newId);
              }
              // for
              const fr = $el.attr('for');
              if (fr) {
                const newFor = fr.replace(/ch(?:X|\d+)/g, 'ch' + newNum);
                if (newFor !== fr) $el.attr('for', newFor);
              }
            });
          });

          console.debug('renumberAllChildren: child count =', $wrappers.length);
        }

        function rebuildSwapButtons() {
          // Add or remove swap buttons based on child position
          const $childrenCardBody = $('#children').closest('.card').find('.card-body').first();
          if (!$childrenCardBody.length) return;
          
          $childrenCardBody.children('.child-row').each(function(index) {
            const $wrapper = $(this);
            const childNum = index + 1;
            const $headerRow = $wrapper.children('.row').first();
            const $existingSwap = $headerRow.find('.child-swap-btn');
            
            if (childNum === 1) {
              // First child: remove swap button if exists
              $existingSwap.closest('.col-sm-auto').remove();
            } else {
              // Child 2+: ensure swap button exists
              if (!$existingSwap.length) {
                const swapButtonHTML = `
                  <div class="col-sm-auto ml-auto">
                    <button type="button" class="btn btn-outline-primary btn-sm child-swap-btn" data-child-index="${childNum}" title="Échanger avec l'enfant précédent">
                      <span class="far fa-user"></span>
                      <span class="fa fa-right-left mx-1"></span>
                      <span class="far fa-user"></span>
                    </button>
                  </div>`;
                $headerRow.append(swapButtonHTML);
              } else {
                // Update data-child-index
                $existingSwap.attr('data-child-index', childNum);
              }
            }
          });
        }

        // Hide labels that are placed above/below inputs so only placeholders remain
        function hideLabelsUnderFields() {
          try {
            // Hide small helper text that sits immediately after controls
            $('input.form-control, textarea.form-control, select.form-control').each(function() {
              const $ctrl = $(this);
              // check immediate container's next sibling (common structure)
              const $next = $ctrl.closest('div').next();
              if ($next && ($next.is('small.form-text') || $next.hasClass('form-text'))) {
                $next.hide();
              }
            });

            // Hide labels that are in a row without inputs but followed by a row that contains inputs
            $('label.col-form-label').each(function() {
              const $lab = $(this);
              if ($lab.hasClass('text-uppercase') || $lab.hasClass('sr-only') || $lab.closest('.form-check').length || $lab.hasClass('custom-control-label')) return;
              const $row = $lab.closest('.row');
              if (!$row.length) return;
              // If this same row already contains inputs, keep the label
              if ($row.find('input.form-control, select.form-control, textarea.form-control').length) return;

              // Look for next rows until a row with inputs is found (or stop)
              let $next = $row.next();
              while ($next.length) {
                if ($next.find('input.form-control, select.form-control, textarea.form-control').length) {
                  // This label is followed by a row that contains the input -> hide it
                  $lab.hide();
                  break;
                }
                // stop if next row contains another label header (likely a new section)
                if ($next.find('h5, h3').length) break;
                $next = $next.next();
              }
            });
          } catch (err) {
            console.warn('hideLabelsUnderFields error', err);
          }
        }

        function rebuildInsertRows() {
          const $childrenCardBody = $('#children').closest('.card').find('.card-body').first();
          if (!$childrenCardBody.length) return;
          // Remove existing insert rows
          $childrenCardBody.children('.insert-row').remove();

          const $wrappers = $childrenCardBody.children('.child-row');

          // Recreate: insert-row before each child, then one after last
          const insertPositions = [];
          $wrappers.each(function(i) {
            insertPositions.push({ index: i, $before: $(this) });
          });

          // Insert before each wrapper
          insertPositions.forEach(function(pos) {
            pos.$before.before(createInsertChildRow(pos.index));
          });

          // Insert after last wrapper
          if ($wrappers.length) {
            $wrappers.last().after(createInsertChildRow($wrappers.length));
          } else {
            // no wrappers, add one insert row at start
            $childrenCardBody.append(createInsertChildRow(0));
          }
        }

        function extractChildNumber($row) {
          // Try to find numeric child number from any input name chN_
          const $input = $row.find('[name^="ch"]').first();
          if ($input.length) {
            const match = $input.attr('name').match(/^ch(\d+|X)/);
            if (match) return match[1] === 'X' ? null : parseInt(match[1]);
          }
          return null;
        }

        // Bind create/link toggle handlers to all child selects
        function bindChildToggleHandlers() {
          console.debug('bindChildToggleHandlers: binding to', $('.child-row').length, 'children');
          $('.child-row').each(function(idx) {
            const $wrapper = $(this);
            const $select = $wrapper.find('select[id$="_p_selct"]').first();
            
            if (!$select.length) {
              console.warn('No select found in child wrapper', idx);
              return;
            }
            
            $select.off('change.childToggle').on('change.childToggle', function() {
              const selectId = $select.attr('id');
              const prefix = selectId.replace('_p_selct', '');
              
              console.debug('Toggle fired for', prefix, 'value:', $select.val());
              
              // Find elements within this wrapper
              const $data = $wrapper.find('#' + prefix + '_p_selct_data');
              const $sex = $wrapper.find('#' + prefix + '_p_selct_sex');
              const $mod = $wrapper.find('#' + prefix + '_p_selct_mod');
              
              console.debug('Found elements:', {
                data: $data.length,
                sex: $sex.length,
                mod: $mod.length
              });
              
              const isLink = $select.val() === 'link';
              
              $data.toggle(!isLink);
              $sex.toggle(!isLink);
              $mod.toggle(isLink);
            });
            
            // Trigger initial state
            $select.trigger('change.childToggle');
          });
        }

        // Bind create/link toggle handlers to parent selects
        function bindParentToggleHandlers() {
          ['pa1', 'pa2'].forEach(function(prefix) {
            const $select = $('#' + prefix + '_p_selct');
            if (!$select.length) return;
            const $data = $('#' + prefix + '_p_selct_data');
            const $mod = $('#' + prefix + '_p_selct_mod');
            $select.off('change.parentToggle').on('change.parentToggle', function() {
              const isLink = $select.val() === 'link';
              $data.toggle(!isLink);
              $mod.toggle(isLink);
            });
            $select.trigger('change.parentToggle');
          });
        }

        // Bind create/link toggle handlers to all witness selects
        function bindWitnessToggleHandlers() {
          console.debug('bindWitnessToggleHandlers: scanning witnesses');
          $('select[id$="_p_selct"]').each(function() {
            const $select = $(this);
            const id = $select.attr('id') || '';
            // Match witness selects: e{event}_witn{num}_p_selct
            const m = id.match(/^e\d+_witn\d+_p_selct$/);
            if (!m) return; // skip non-witness selects

            // Determine prefix used to build related element IDs
            const prefix = id.replace('_p_selct', '');
            const $wrapper = $select.closest('.row').nextAll().addBack(); // search in the following sibling rows too
            const $data = $('#'+prefix+'_p_selct_data');
            const $sex = $('#'+prefix+'_p_selct_sex');
            const $mod = $('#'+prefix+'_p_selct_mod');

            // Guard if missing containers
            if (!$data.length && !$sex.length && !$mod.length) return;

            $select.off('change.witnessToggle').on('change.witnessToggle', function() {
              const isLink = $select.val() === 'link';
              $data.toggle(!isLink);
              $sex.toggle(!isLink);
              $mod.toggle(isLink);
            });

            // Trigger initial state
            $select.trigger('change.witnessToggle');
          });
        }

        function createChildForm(num, withSwapButton) {
          const idx = (num === 'X' || num === undefined) ? 'X' : num;
          // Localized ordinals rendered at template time
          const ordinals = ['', '{{ _("1st") }}', '{{ _("2nd") }}', '{{ _("3rd") }}', '{{ _("4th") }}', '{{ _("5th") }}', '{{ _("6th") }}', '{{ _("7th") }}', '{{ _("8th") }}', '{{ _("9th") }}', '{{ _("10th") }}'];
          const ordinal = idx === 'X' ? '{{ _("Child") }}' : (idx < ordinals.length ? ordinals[idx] : (idx + ''));
          
          // Swap button appears only for child 2+ (or when explicitly requested)
          const showSwap = withSwapButton || (typeof idx === 'number' && idx > 1);
          const swapButtonHTML = showSwap ? `
              <div class="col-sm-auto ml-auto">
                <button type="button" class="btn btn-outline-primary btn-sm child-swap-btn" data-child-index="${idx}" title="{{ _('Swap with previous child') }}">
                  <span class="far fa-user"></span>
                  <span class="fa fa-right-left mx-1"></span>
                  <span class="far fa-user"></span>
                </button>
              </div>` : '';

          const childFormHTML = `
            <div class="child-row" data-child-index="${idx}">
            <div class="row">
              <hr class="w-100" />
              <h5 class="col-form-label col-sm-2 text-uppercase">${ordinal} {{ _('Child') }}</h5>
              <div class="col-sm-2">
                <select class="form-control" name="ch${idx}_p" id="ch${idx}_p_selct">
                  <option value="link">{{ _('Link') }}</option>
                  <option value="create" selected>{{ _('Create') }}</option>
                </select>
              </div>
              ${swapButtonHTML}
            </div>
            <div class="row">
              <label for="ch${idx}_fn" class="col-sm-2 col-form-label">{{ _('First name') }}</label>
              <div class="col-sm-6">
                <input class="form-control" type="text" name="ch${idx}_fn" value="" id="ch${idx}_fn" placeholder="{{ _('First name') }}" list="datalist_fnames" data-book="fn" />
              </div>
              <label for="ch${idx}_occ" class="col-sm-auto col-form-label">{{ _('Number') }}</label>
              <div class="col-sm-2">
                <input class="form-control" type="number" name="ch${idx}_occ" min="0" value="0" id="ch${idx}_occ" />
              </div>
            </div>
            <div class="row">
              <label for="ch${idx}_sn" class="col-sm-2 col-form-label">{{ _('Surname') }}</label>
              <div class="col-sm-6">
                <input class="form-control" type="text" name="ch${idx}_sn" value="" id="ch${idx}_sn" placeholder="" list="datalist_snames" data-book="sn" />
              </div>
              <div id="ch${idx}_p_selct_mod" class="col-form-label ml-2" style="display:none;">
                <a href="#" onclick="alert('MOD_IND route not yet implemented'); return false;">
                  <i class="fa fa-user-pen fa-fw ml-2 mr-1"></i>
                  {{ _('Modify child') }}
                </a>
              </div>
              <div id="ch${idx}_p_selct_sex">
                <div class="d-inline-flex">
                  <span class="col-sm-auto col-form-label">{{ _('Sex') }}</span>
                  <div class="col-sm-auto mt-2">
                    <div class="form-check form-check-inline">
                      <label class="form-check-label">
                        <input class="form-check-input" type="radio" name="ch${idx}_sex" value="M" />{{ _('M') }}
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label">
                        <input class="form-check-input" type="radio" name="ch${idx}_sex" value="N" checked />{{ _('?') }}
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label">
                        <input class="form-check-input" type="radio" name="ch${idx}_sex" value="F" />{{ _('F') }}
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="ch${idx}_p_selct_data">
              <div class="row align-items-center">
                <span class="col-sm-2 col-form-label">{{ _('Birth') }}</span>
                <div class="col-sm-auto d-inline-flex">
                  <label for="ch${idx}b_dd" class="col-form-label sr-only">{{ _('day') }}</label>
                  <input type="text" class="form-control mr-2" name="ch${idx}b_dd" id="ch${idx}b_dd" value="" placeholder="{{ _('dd') }}" pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])" size="2" maxlength="2" />
                  <label for="ch${idx}b_mm" class="col-form-label sr-only">{{ _('month') }}</label>
                  <input type="text" class="form-control mr-2" name="ch${idx}b_mm" id="ch${idx}b_mm" value="" placeholder="{{ _('mm') }}" pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)" size="1" maxlength="2" />
                  <label for="ch${idx}b_yyyy" class="col-form-label sr-only">{{ _('year') }}</label>
                  <input type="text" class="form-control mr-2" name="ch${idx}b_yyyy" id="ch${idx}b_yyyy" value="" placeholder="{{ _('yyyy') }}" pattern="[?><~/+\\-]?\\d*/?" size="4" maxlength="8" />
                </div>
                <label for="ch${idx}b_pl" class="sr-only col-sm-1 col-form-label">{{ _('place') }}</label>
                <div class="col">
                  <input type="text" class="form-control" name="ch${idx}b_pl" value="" id="ch${idx}b_pl" placeholder="{{ _('Place') }}" list="datalist_places" data-book="{{ _('place') }}" />
                </div>
              </div>
              <div class="row align-items-center">
                <span class="col-sm-2 col-form-label">{{ _('Death') }}</span>
                <div class="col-sm-auto d-inline-flex">
                  <label for="ch${idx}d_dd" class="col-form-label sr-only">{{ _('day') }}</label>
                  <input type="text" class="form-control mr-2" name="ch${idx}d_dd" id="ch${idx}d_dd" value="" placeholder="{{ _('dd') }}" pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])" size="2" maxlength="2" />
                  <label for="ch${idx}d_mm" class="col-form-label sr-only">{{ _('month') }}</label>
                  <input type="text" class="form-control mr-2" name="ch${idx}d_mm" id="ch${idx}d_mm" value="" placeholder="{{ _('mm') }}" pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)" size="1" maxlength="2" />
                  <label for="ch${idx}d_yyyy" class="col-form-label sr-only">{{ _('year') }}</label>
                  <input type="text" class="form-control mr-2" name="ch${idx}d_yyyy" id="ch${idx}d_yyyy" value="" placeholder="{{ _('yyyy') }}" pattern="[?><~/+\\-]?\\d*/?" size="4" maxlength="8" />
                </div>
                <label for="ch${idx}d_pl" class="sr-only col-sm-1 col-form-label">{{ _('place') }}</label>
                <div class="col">
                  <input type="text" class="form-control" name="ch${idx}d_pl" value="" id="ch${idx}d_pl" placeholder="{{ _('Place') }}" list="datalist_places" data-book="{{ _('place') }}" />
                </div>
              </div>
              <div class="row">
                <label for="ch${idx}_occu" class="col-sm-2 col-form-label">{{ _('Occupation') }}</label>
                <div class="col-sm">
                  <input class="form-control" type="text" name="ch${idx}_occu" value="" id="ch${idx}_occu" placeholder="{{ _('Occupation') }}" list="datalist_occupations" data-book="occu" />
                </div>
              </div>
            </div>
            </div>
          `;

          return $(childFormHTML);
        }

        function createInsertChildRow(afterChildNum) {
          // Build an insert control placed between children. Button is type="button" to avoid form submit.
          const options = Array.from({length:10}, (_,i) => `<option>${i+1}</option>`).join('');
          const $el = $(`
            <div class="row insert-row">
              <label class="col-form-label col-2">{{ _('Insert') }}</label>
                  <div class="form-inline col-10 ml-auto">
                    <div class="input-group">
                      <select style="width:6rem;" class="form-control bg-light border-primary border-right-0" name="ins_ch${afterChildNum}_n" id="ins_ch${afterChildNum}_n">
                        ${options}
                      </select>
                      <div class="input-group-append">
                        <button type="button" class="btn btn-outline-primary child-insert-btn" data-after="${afterChildNum}" title="{{ _('Insert child(ren)') }}">{{ _('Insert') }}</button>
                      </div>
                    </div>
                  </div>
            </div>
          `);
          return $el;
        }
        
        function createEventForm(num) {
          return $(`
            <div class="row">
              <h5 class="col-form-label col-sm-2 mb-1 text-uppercase">
                <label for="e_name${num}" class="mb-0">{{ _('Event') }} ${num}</label>
              </h5>
              <div class="col-sm-3">
                <select class="form-control custom-select font-weight-bold" id="fevent_select${num}" onchange="show_fevent_label($('#e_name${num}').prop('defaultValue'), '${num}')">
                  <option value="" selected disabled>{{ _('Choose an event') }}</option>
                  <option disabled>───────────────</option>
                  <option value="#marr">{{ _('Marriage') }}</option>
                  <option value="#nmar">{{ _('Not married') }}</option>
                  <option value="#enga">{{ _('Engaged') }}</option>
                  <option value="#nmen">{{ _('No mention') }}</option>
                  <option value="#marb">{{ _('Marriage banns') }}</option>
                  <option value="#marc">{{ _('Marriage contract') }}</option>
                  <option value="#marl">{{ _('Marriage license') }}</option>
                  <option value="#pacs">{{ _('Civil union') }}</option>
                  <option value="#div">{{ _('Divorce') }}</option>
                  <option value="#sep">{{ _('Separation') }}</option>
                  <option value="#anul">{{ _('Annulment') }}</option>
                  <option value="#resi">{{ _('Residence') }}</option>
                  <option disabled>───────────────</option>
                  <option value="" id="custom${num}">{{ _('Custom event') }}</option>
                  <option disabled>───────────────</option>
                  <option value="" id="delete${num}">{{ _('Delete event') }}</option>
                </select>
              </div>
              <div class="col-sm-7">
                <label id="fevent_label_selector${num}" style="display: none" class="other_evts w-100">
                  <input type="text" class="form-control font-weight-bold" name="e_name${num}" value="#marr" id="e_name${num}" placeholder="{{ _('Event') }}" />
                </label>
              </div>
            </div>
            <div class="row mb-2">
              <label for="e_place${num}" class="col-sm-2 col-form-label">{{ _('Place') }}</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" name="e_place${num}" value="" id="e_place${num}" placeholder="{{ _('Place') }}" list="datalist_places" data-book="{{ _('place') }}" />
              </div>
            </div>
            <div class="row mt-1">
              <div class="col-sm-1 col-md-2 col-form-label">{{ _('Date') }}</div>
              <div class="col col-sm-auto form-inline">
                <label>
                  <input type="text" class="form-control" name="e_date${num}_dd" value="" pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])" size="2" maxlength="2" placeholder=" " />
                  <span class="ml-sm-1 ml-md-2">{{ _('day') }}</span>
                </label>
                <label>
                  <span id="e_date${num}_mm_sel">
                    <input type="text" class="form-control ml-sm-2 ml-md-3" name="e_date${num}_mm" id="e_date${num}_mm" value="" pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)" size="1" maxlength="2" placeholder=" " />
                  </span>
                  <span class="ml-sm-1 ml-md-2">{{ _('month') }}</span>
                </label>
                <label>
                  <input type="text" class="form-control ml-sm-2 ml-md-3" name="e_date${num}_yyyy" value="" pattern="[?><~/+\\-]?\\d*/?" size="4" maxlength="8" placeholder=" " />
                  <span class="ml-sm-1 ml-md-2">{{ _('year') }}</span>
                </label>
              </div>
              <div class="col-10 col-lg ml-auto form-inline">
                <select class="form-control pl-lg-1 pr-lg-0 px-xl-2" name="e_date${num}_prec" id="e_date${num}_prec">
                  <option value="sure">{{ _('exact') }}</option>
                  <option value="about">{{ _('about') }}</option>
                  <option value="maybe">{{ _('maybe') }}</option>
                  <option value="before">{{ _('before') }}</option>
                  <option value="after">{{ _('after') }}</option>
                  <option value="oryear">{{ _('…or…') }}</option>
                  <option value="yearint">{{ _('…between…') }}</option>
                </select>
                <select class="form-control pl-lg-1 pr-lg-0 px-xl-2 ml-sm-1 ml-md-3" name="e_date${num}_cal" id="e_date${num}_cal" onchange="changeCalendar('e_date${num}_mm_sel','e_date${num}_mm','',this),changeCalendar('e_date${num}_ormonth_sel','e_date${num}_ormonth','',this)">
                  <option value="" selected>-</option>
                  <option value="G">{{ _('Gregorian') }}</option>
                  <option value="J">{{ _('Julian') }}</option>
                  <option value="F">{{ _('French Republican') }}</option>
                  <option value="M">{{ _('Hebrew') }}</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-1 col-md-2"></div>
              <div class="col col-sm-auto form-inline">
                <label>
                  <input type="text" class="form-control" name="e_date${num}_orday" value="" pattern="(?:0?[1-9]|1[0-9]|2[0-9]|3[0-1])" size="2" maxlength="2" placeholder=" " />
                  <span class="ml-sm-1 ml-md-2">{{ _('day') }}</span>
                </label>
                <label>
                  <span id="e_date${num}_ormonth_sel">
                    <input type="text" class="form-control ml-sm-1 ml-md-3" name="e_date${num}_ormonth" id="e_date${num}_ormonth" value="" pattern="(?:0?[1-9]|1[0-2]|VD|BR|FM|NI|PL|VT|GE|FL|PR|ME|TH|FT|JC|vd|br|fm|ni|pl|vt|ge|fl|pr|me|th|ft|jc)" size="1" maxlength="2" placeholder=" " />
                  </span>
                  <span class="ml-sm-1 ml-md-2">{{ _('month') }}</span>
                </label>
                <label>
                  <input type="text" class="form-control ml-sm-1 ml-md-3" name="e_date${num}_oryear" value="" pattern="[?><~/+\\-]?\\d*/?" size="4" maxlength="8" placeholder=" " />
                  <span class="ml-sm-1 ml-md-2">{{ _('year') }}</span>
                </label>
              </div>
              <div class="col-10 col-lg">
                <label for="e_date${num}_text" class="col-form-label sr-only"></label>
                <input type="text" class="form-control" name="e_date${num}_text" maxlength="100" value="" id="e_date${num}_text" placeholder="{{ _('…or text') }}" />
              </div>
            </div>
            <div class="row mt-2">
              <label for="e_note${num}" class="col-sm-2 col-form-label">{{ _('Notes') }}</label>
              <div class="col-sm-10 d-inline-flex align-items-start">
                <textarea class="form-control" name="e_note${num}" rows="1" id="e_note${num}" placeholder="{{ _('Notes') }}"></textarea>
              </div>
            </div>
            <div class="row mt-0">
              <label for="e_src${num}" class="col-sm-2 col-form-label">{{ _('Source') }}</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" name="e_src${num}" maxlength="1000" id="e_src${num}" placeholder="{{ _('Source') }}" value="" list="datalist_sources" data-book="src" />
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="row mt-3 mb-1">
                  <label for="e${num}_ins_witn0_n" class="col-form-label col-2">{{ _('Insert') }}</label>
                  <div class="form-inline col-10 ml-auto">
                    <div class="input-group">
                      <select class="form-control bg-light border-primary border-right-0" id="e${num}_ins_witn0_n" name="e${num}_ins_witn0_n">
                        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
                        <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
                      </select>
                      <div class="input-group-append">
                        <label class="btn btn-outline-primary border-left-0">
                          {{ _('witness(es)') }}
                          <input class="ml-1" type="checkbox" name="e${num}_ins_witn0" value="on" />
                        </label>
                        <button type="submit" class="btn btn-outline-primary" title="{{ _('Insert witness(es)') }}">OK</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr class="w-100" />
          `);
        }
        
        function createWitnessForm(eventNum, witnessNum) {
          return $(`
            <hr />
            <div class="row">
              <h5 class="col-form-label col-2">{{ _('Witness') }} ${witnessNum}</h5>
              <div class="col-2">
                <select class="form-control" name="e${eventNum}_witn${witnessNum}_p" id="e${eventNum}_witn${witnessNum}_p_selct">
                  <option value="create" selected>{{ _('Create') }}</option>
                  <option value="link">{{ _('Link') }}</option>
                </select>
              </div>
              <div id="e${eventNum}_witn${witnessNum}_p_selct_mod" class="col-form-label ml-2" style="display:none;">
                <a href="#" onclick="alert('MOD_IND route not yet implemented'); return false;">
                  <i class="fa fa-user-pen fa-fw ml-2 mr-1"></i>
                  {{ _('Modify witness') }}
                </a>
              </div>
              <div id="e${eventNum}_witn${witnessNum}_p_selct_kind" class="col-4">
                <select class="form-control" name="e${eventNum}_witn${witnessNum}_kind">
                  <option value="" selected>{{ _('Witness') }}</option>
                  <option value="info">{{ _('Informant') }}</option>
                  <option value="atte">{{ _('Present') }}</option>
                  <option value="ment">{{ _('Mentioned') }}</option>
                  <option value="offi">{{ _('Civil registrar') }}</option>
                  <option value="reli">{{ _('Minister of worship') }}</option>
                  <option value="othe">{{ _('Other') }}</option>
                </select>
              </div>
            </div>
            <div class="row">
              <label for="e${eventNum}_witn${witnessNum}_fn" class="col-sm-2 col-form-label">{{ _('First name') }}</label>
              <div class="col-sm-6">
                <input class="form-control" type="text" name="e${eventNum}_witn${witnessNum}_fn" value="" id="e${eventNum}_witn${witnessNum}_fn" placeholder="{{ _('First name') }}" list="datalist_fnames" data-book="fn" />
              </div>
              <label for="e${eventNum}_witn${witnessNum}_occ" class="col-sm-auto col-form-label">{{ _('Number') }}</label>
              <div class="col-sm-2">
                <input class="form-control" type="number" name="e${eventNum}_witn${witnessNum}_occ" min="0" value="0" id="e${eventNum}_witn${witnessNum}_occ" />
              </div>
            </div>
            <div class="row">
              <label for="e${eventNum}_witn${witnessNum}_sn" class="col-sm-2 col-form-label">{{ _('Surname') }}</label>
              <div class="col-sm-6">
                <input class="form-control" type="text" name="e${eventNum}_witn${witnessNum}_sn" value="" id="e${eventNum}_witn${witnessNum}_sn" placeholder="{{ _('Surname') }}" list="datalist_snames" data-book="sn" />
              </div>
              <div id="e${eventNum}_witn${witnessNum}_p_selct_sex" class="col-form-label">
                <div class="form-inline">
                  <div class="col-sm-auto">{{ _('Sex') }}</div>
                  <div class="form-check form-check-inline ml-5">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="e${eventNum}_witn${witnessNum}_sex" value="M" />{{ _('M') }}
                    </label>
                  </div>
                  <div class="form-check form-check-inline">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="e${eventNum}_witn${witnessNum}_sex" value="N" checked />{{ _('?') }}
                    </label>
                  </div>
                  <div class="form-check form-check-inline">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="e${eventNum}_witn${witnessNum}_sex" value="F" />{{ _('F') }}
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div class="row" id="e${eventNum}_witn${witnessNum}_p_selct_data">
              <label for="e${eventNum}_witn${witnessNum}_occu" class="col-sm-2 col-form-label">{{ _('Occupation') }}</label>
              <div class="col-sm-6">
                <input class="form-control" type="text" name="e${eventNum}_witn${witnessNum}_occu" value="" id="e${eventNum}_witn${witnessNum}_occu" placeholder="{{ _('Occupation') }}" list="datalist_occupations" data-book="occu" />
              </div>
              <div class="form-inline col-sm-auto">
                <div class="custom-control custom-checkbox mr-3">
                  <input class="custom-control-input" type="checkbox" name="e${eventNum}_witn${witnessNum}_od" id="e${eventNum}_witn${witnessNum}_od">
                  <label for="e${eventNum}_witn${witnessNum}_od" class="custom-control-label">{{ _('Obviously deceased') }}</label>
                </div>
                <div class="custom-control custom-checkbox">
                  <input class="custom-control-input" type="checkbox" name="e${eventNum}_witn${witnessNum}_pub" id="e${eventNum}_witn${witnessNum}_pub">
                  <label for="e${eventNum}_witn${witnessNum}_pub" class="custom-control-label">{{ _('Public') }}</label>
                </div>
              </div>
            </div>
          `);
        }
        
        // Initial attachment: normalize existing structure, renumber and wire handlers
        normalizeChildStructure();
        renumberAllChildren();
        rebuildInsertRows();
        rebuildSwapButtons();
        // Bind toggles AFTER renumbering so IDs are final
        bindChildToggleHandlers();
        bindParentToggleHandlers();
        bindWitnessToggleHandlers();
        attachEventHandlers();
      });
    </script>
  </body>
</html>
